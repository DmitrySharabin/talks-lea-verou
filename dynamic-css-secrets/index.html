<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8" />
<title>Dynamic CSS Secrets</title>
<link href="https://inspirejs.org/inspire.css" rel="stylesheet" />
<link href="https://inspirejs.org/theme.css" rel="stylesheet" />
<link href="../shared/intro-outro.css" rel="stylesheet" />
<link href="css/prism.css" rel="stylesheet" />
<link href="css/theme.css" rel="stylesheet" />
<link href="css/talk.css" rel="stylesheet" />
<link href="../shared/browser-support.css" rel="stylesheet" />
</head>
<body class="language-css"
	data-markdown-elements="details.notes, .md, .takeaway.slide > h1, .credit"
	data-balance-elements=".slide > h1:only-child, .takeaway.slide > h1, .speech.slide > h1">

<header id="intro" class="slide dont-resize">
	<h1>Dynamic CSS
		<div class="secrets"><span>Secrets</span></div>
	</h1>
	<p class="attribution">By <a href="http://lea.verou.me">Lea Verou</a> (<a href="http://twitter.com/leaverou">@LeaVerou</a>)</p>
</header>

<article class="slide" id="lea-verou">
	<h1>¬°Hola, soy Lea! üëãüèº
		<div class="social">
			<a class="social" href="https://twitter.com">@leaverou</a>
			&bull;
			<a class="social" href="https://front-end.social">@leaverou@front-end.social</a>
		</div>

	</h1>

	<img src="../shared/img/lea.jpg" alt="">

	<ul class="delayed-children">
		<li><strong>CSS WG</strong> Invited Expert</li>
		<li><a href="https://lea.verou.me/publications/#specifications">Co-editor of CSS Color, CSS Images, CSS Backgrounds & Borders specs</a></li>
		<li><strong>W3C Technical Architecture Group (TAG)</strong> Member</li>
		<li>Human-Computer Interaction researcher @ <strong>MIT</strong> (research & teaching)</li>
		<li>Started <a href="https://github.com/leaverou">dozens of open source projects</a>, some used on <a href="https://www.npmjs.com/package/prismjs">millions of websites</a></li>
	</ul>
</article>

<article class="slide" id="web-almanac">
	<header>
		<h1>Web Almanac</h1>
		<h2>HTTP Archive‚Äôs annual<br> <b>state of the web</b> report</h2>
		<a href="https://almanac.httparchive.org/" class="url">almanac.httparchive.org</a>
	</header>
	<img src="img/web-almanac.webp" alt="">

</article>

<article class="white slide heading-2x1">
	<h1>Custom properties in 2021</h1>

	<img src="img/cp-depth.png" alt="">
	<pre><code>
		:root {
			/* depth = 0 */
			--h: 335;

			/* depth = 1 */
			--hs: var(--h) 90%;

			/* depth = 2 */
			--color: hsl(var(--hs) 50%);
		}
	</code></pre>
	<details class="notes md">
		Source: [Web Almanac 2021](https://almanac.httparchive.org/en/2021/css#custom-properties)
	</details>
</article>

<article class="white slide heading-1x1" style="overflow: hidden">
	<h1>Custom properties in 2021</h1>

	<h-chart type="pie" style="transform-origin: top; transform: scale(.9); font-weight: normal">
		<table id="simple-data">
			<thead>
				<tr>
					<th>Element</th>
					<th>Usage percentage</th>
				</tr>
			</thead>
			<tbody>
			<tr>
				<td>:root</td>
				<td>60</td>
			</tr>
			<tr>
				<td>body</td>
				<td>5</td>
			</tr>
			<tr>
				<td>Other elements</td>
				<td>35</td>
			</tr>
			</tbody>
		</table>
	</h-chart>
	<script data-src="https://projects.verou.me/h-chart/src/h-chart.js" type="module"></script>
</article>

<article class="slide" id="scratching-surface">
	<h1>
		We got kickass reactive variables<br>
		and we are still treating them<br>
		as glorified constants
	</h1>
	<details class="notes bottom-right">
		Custom properties [reached full browser support 5 years ago](https://caniuse.com/css-variables).
		Why are we still merely scratching the surface?
	</details>
</article>

<article class="slide" id="topics">
	<h1>Today‚Äôs talk:<br>A story in three acts</h1>
	<script type="module">
		for (let slide of document.querySelectorAll("header.part.slide, #conclusion.slide")) {
			let article = document.createElement("article");
			article.className = (slide.matches("header") ? "header " : "") +  "thumbnail delayed";
			if (slide.id) {
				article.dataset.id = slide.id;
			}
			article.style.cssText = slide.style.cssText;
			article.innerHTML = slide.innerHTML;
			topics.append(article);
		}
	</script>
</article>

<section>
	<header class="part slide" style="--icon: üî≤; --icon-2: üî≥; background-color: var(--color-green); --group-background: var(--color-aqua)">
		<h1 data-group="Act I">The Outlined Button</h1>
	</header>

	<article class="isolated demo slide" id="button-implementation" style="--division: 70">
		<textarea class="language-html">
			<button>Click me</button>
			<button class="pink">Click me</button>
		</textarea>

		<textarea class="language-css">
			button {
				border: .1em solid black;
				background: transparent;
				color: black;
			}

			button:hover {
				background: black;
				color: white;
			}

			button.pink {
				border-color: #f06;
				color: #f06;
			}

			button.pink:hover {
				background: #f06;
				color: white;
			}
		</textarea>
		<style class="demo" data-slide media="not all">
			button {
				border-radius: .3em;
				padding: .1em .5em .15em;
				font-size: 180%;
				margin: .2em;
				cursor: pointer;
			}
		</style>
		<script class="demo-script" type="application/json">
			[
				{"type":"caret","start":63,"end":63,"editor":"css"},{"type":"insertText","text":"--","split":true},{"type":"caret","start":78,"end":78},{"type":"insertText","text":"\n\tcolor: var","split":true},"()",{"type":"caret","start":91,"end":91},{"type":"insertText","text":"--color","split":true},{"type":"caret","start":99,"end":99},";",{"type":"caret","start":29,"end":34},{"type":"insertText","text":"var","split":true},"()",{"type":"caret","start":33,"end":33},{"type":"insertText","text":"--color","split":true},{"type":"caret","start":139,"end":144},"var(--color)",
				{"type":"pause","delay":5000},{"type":"caret","start":207,"end":207},{"type":"insertText","text":"--","split":true},{"type":"caret","start":185,"end":205},{"type":"deleteContentBackward","repeat":2},{"type":"caret","start":203,"end":259},{"type":"deleteContentBackward","repeat":2},

				{"type":"pause"},{"type":"caret","start":7,"end":7,"editor":"html"},{"type":"insertText","text":" style=","split":true},"\"\"",{"type":"caret","start":15,"end":15},{"type":"insertText","text":"--color: blue","split":true},
				{"type":"pause"},{"type":"caret","start":8,"end":29},{"type":"insertText","text":"onclick=","split":true},"\"\"",{"type":"caret","start":17,"end":17},{"type":"insertText","text":"this.style.setProperty","split":true},"()",{"type":"caret","start":40,"end":40},"''",{"type":"caret","start":41,"end":41},{"type":"insertText","text":"--color","split":true},{"type":"caret","start":49,"end":49},{"type":"insertText","text":",\n","split":true},"``",{"type":"caret","start":52,"end":52},{"type":"insertText","text":"hsl","split":true},"()",{"type":"caret","start":56,"end":56},"$","{}",{"type":"caret","start":58,"end":58},{"type":"insertText","text":"Math.random","split":true},"()",{"type":"caret","start":71,"end":71},{"type":"insertText","text":" * 360","split":true},{"type":"caret","start":78,"end":78},{"type":"insertText","text":" 90% 50%","split":true},
				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause","delay":5000},{"type":"caret","start":40,"end":40,"editor":"css"},{"type":"insertText","text":", black","split":true},{"type":"caret","start":112,"end":112},{"type":"insertText","text":", black","split":true},{"type":"caret","start":164,"end":164},{"type":"insertText","text":", black","split":true},{"type":"caret","start":76,"end":92},{"type":"deleteContentBackward","repeat":2},
				{"type":"pause","delay":5000},{"type":"caret","start":8,"end":8},{"type":"insertText","text":"\n\t--color-ii","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"nitial: black;","split":true},{"type":"caret","start":67,"end":72},{"type":"insertText","text":"var","split":true},"()",{"type":"caret","start":71,"end":71},"--color-initial",{"type":"caret","start":137,"end":142},"var(--color-initial)",{"type":"caret","start":204,"end":209},"var(--color-initial)",
				{"type":"pause","delay":5000},{"type":"caret","start":33,"end":33},{"type":"caret","start":12,"end":33},{"type":"insertText","text":"_color: a","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"var","split":true},"()",{"type":"caret","start":24,"end":24},{"type":"insertText","text":"--color, black","split":true},{"type":"caret","start":39,"end":39},";",
				{"type":"pause"},{"type":"caret","start":67,"end":67},"_",{"type":"caret","start":73,"end":95},{"type":"deleteContentBackward"},{"type":"caret","start":110,"end":144},"var(--_color)",{"type":"caret","start":156,"end":190},"var(--_color)",
				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause"},{"type":"caret","start":124,"end":124},{"type":"insertText","text":"\n\ttransition: 1s;","split":true},{"type":"pause","delay":3810},{"type":"caret","start":161,"end":171},{"type":"insertText","text":"box-shadow","split":true},{"type":"caret","start":172,"end":172},{"type":"insertText","text":" 0 0 0 1em","split":true},{"type":"caret","start":196,"end":196},{"type":"insertText","text":" inset","split":true},

				{"type":"pause"},{"type":"next_slide"},

				{"type":"pause"},{"type":"caret","start":196,"end":202,"editor":"css"},{"type":"deleteContentBackward"},{"type":"caret","start":173,"end":183},{"type":"deleteContentBackward"},{"type":"caret","start":161,"end":171},{"type":"insertText","text":"background","split":true},{"type":"caret","start":125,"end":141},{"type":"deleteContentBackward","repeat":2},
				{"type":"pause","delay":5000},{"type":"caret","start":124,"end":128,"editor":"html"},{"type":"insertText","text":"rainbow","split":true},
				{"type":"pause"},{"type":"caret","start":196,"end":200,"editor":"css"},{"type":"insertText","text":"rainbow","split":true},{"type":"caret","start":216,"end":220},{"type":"insertText","text":"hsl","split":true},{"type":"insertText","text":"()"},{"type":"caret","start":220,"end":220},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","start":224,"end":224},{"type":"insertText","text":"--color-hue","split":true},{"type":"caret","start":236,"end":236},{"type":"insertText","text":" 60% 50%","split":true},{"type":"caret","start":246,"end":246},
				{"type":"pause"},{"type":"caret","start":187,"end":187},{"type":"insertText","text":"\n\n@keyframes color-hue ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","start":211,"end":211},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","start":212,"end":212},{"type":"insertText","text":"\tfrom ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","start":219,"end":219},{"type":"insertText","text":" --color-hue: 0; ","split":true},{"type":"caret","start":237,"end":237},{"type":"insertText","text":"\n\tto ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","start":243,"end":243},{"type":"insertText","text":" --color-hue: 180; ","split":true},{"type":"caret","start":324,"end":324},{"type":"insertText","text":"\n\tanimation: 5s color-hue linear infinite;","split":true},
				{"type":"pause"},{"type":"caret","start":187,"end":187},{"type":"insertText","text":"\n\n@property --color-hue ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","start":212,"end":212},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","start":213,"end":213},{"type":"insertText","text":"\tsyntax: ","split":true},{"type":"insertText","text":"\"\""},{"type":"caret","start":223,"end":223},{"type":"insertText","text":"<number","split":true},{"type":"caret","start":230,"end":230},{"type":"insertText","text":">"},{"type":"caret","start":232,"end":232},{"type":"insertText","text":";\n\tinitial-value: 0;\n\tinherits: true;","split":true},
				{"type":"pause","delay":5000},{"type":"caret","start":341,"end":344},{"type":"insertText","text":"360","split":true},{"type":"caret","start":421,"end":422},{"type":"insertText","text":"10","split":true},

				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause"},{"type":"caret","start":188,"end":188,"editor":"css"},{"type":"insertText","text":"@property --color-hue {\n\tsyntax: \"<number>\";\n\tinitial-value: 0;\n\tinherits: true;\n}"},{"type":"insertText","text":"\n"},{"type":"caret","start":206,"end":209},{"type":"deleteContentBackward","repeat":2},{"type":"insertText","text":" "},{"type":"caret","start":220,"end":226},{"type":"insertText","text":"color","split":true},{"type":"caret","start":246,"end":246},{"type":"deleteContentBackward"},{"type":"insertText","text":"black","split":true},
				{"type":"pause","delay":3447},{"type":"caret","start":117,"end":117},{"type":"deleteContentBackward"},{"type":"caret","start":68,"end":68},{"type":"deleteContentBackward"},{"type":"caret","start":10,"end":42},{"type":"deleteContentBackward"},{"type":"caret","start":129,"end":129},{"type":"deleteContentBackward"}
			]
		</script>
		<details class="notes">
			This is a simplified flat button whose text color becomes its background color on hover, a common effect.
			Note the repetition required to specify a color variation. Let's use CSS variables to eliminate that!

			After rewriting with CSS variables, only a single `--color` declaration is sufficient to create a color variation of the entire component.

			However, the fallbacks are getting quite repetitive.

			Although the syntax allows us to use a different fallback in every usage,
			in most cases, we don't need that.
			Repeating the fallback value over and over is not [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself).
			What can we do to reduce that duplication?

			Another benefit of custom properties is *encapsulation*.
			We can change how styling works completely, and as long as we use the same custom properties
			anyone using and styling our component doesn't need to change a thing.
		</details>
	</article>

	<article class="takeaway slide">
		<h1>CSS variables are just regular properties</h1>
		<details class="notes">
			What does that mean?

			- They are scoped on the element itself, not on curly braces (lexical vs dynamic scoping)
			- Can be set via inline styles or even JS setting these inline styles
			- As we will see later on, they are actually *inherited properties*
		</details>
	</article>

	<article class="slide" data-insert="#button-implementation"></article>

	<article class="slide takeaway">
		<h1>Pseudo-private variables succinctly reduce fallback duplication</h1>
		<details class="notes">
			Pseudo-private variables are a convention: prefix custom properties by `_` to indicate they are for internal use.
			Useful for baking in fallback values, but also other things.
		</details>
	</article>

	<article class="slide" data-insert="#button-implementation"></article>

	<article class="takeaway slide">
		<h1>CSS Variables allow us to create a higher level styling API</h1>
		<details class="notes">
			Provide encapsulation by exposing a higher level styling API. We can change the underlying CSS and the API we've exposed will continue to work.
			Theming becomes independent of CSS structure.
		</details>
	</article>

	<article class="website slide" id="variables-as-api">
		<h1>CSS variables as API <a class="go" href="https://shoelace.style/components/rating?id=css-custom-properties" target="shoelace_rating">‚û°Ô∏è</a></h1>

		<div class="browser"><iframe src="https://shoelace.style/components/rating" frameborder="0" name="shoelace_rating"></iframe></div>
	</article>

	<article class="slide" data-insert="#button-implementation"></article>

	<article class="takeaway slide">
		<h1>
			CSS variables cannot be interpolated
			<div class="delayed">‚Ä¶unless we register them with <code>@property</code></div>
			<div class="delayed" style="font-size: 50%">(or <code class="language-js">CSS.registerProperty()</code>)</div>
		</h1>
		<details class="notes">
			You may also remember a `CSS.registerProperty()` JS API.
			This came earlier, but at this point support for `@property` is nearly identical.
			The main reason to use `CSS.registerProperty()` these days is because of its richer error reporting.
		</details>
	</article>

	<article class="slide" data-insert="#button-implementation"></article>

	<!-- <article class="takeaway slide">
		<h1 class="md">`@property`-defined initial values take precedence over `var()` fallback</h1>

		<details class="notes">
			And if you provide one, it will never get used.
		</details>
	</article> -->

	<article class="takeaway slide">
		<h1 class="md">`@property` is global
			<div class="delayed note">(except in Shadow trees)</div>
		</h1>


		<details class="notes">
			And if you provide one, it will never get used.
		</details>
	</article>


	<article class="browser-support slide">
		<table>
			<thead>
				<tr>
					<th></th>
					<th><img src="../shared/img/chrome-logo.svg" alt="Chrome"></th>
					<th><img src="../shared/img/firefox-logo.svg" alt="Firefox"></th>
					<th><img src="../shared/img/edge-logo.svg" alt="Edge"></th>
					<th><img src="../shared/img/safari-logo.png" alt="Safari"></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th><a href="https://caniuse.com/css-variables" target="_blank">CSS Variables</a></th>
					<td>49</td>
					<td>31</td>
					<td>15</td>
					<td>9.1</td>
				</tr>
				<tr>
					<th><a href="https://caniuse.com/mdn-css_at-rules_property">@property</a></th>
					<td>85</td>
					<td></td>
					<td>85</td>
					<td></td>
				</tr>
				<tr>
					<th><a href="https://caniuse.com/mdn-api_css_registerproperty">CSS.registerProperty()</a></th>
					<td>79</td>
					<td></td>
					<td>79</td>
					<td></td>
				</tr>
			</tbody>
		</table>
	</article>
</section>

<section>
	<header class="part slide" style="--icon: ‚ú®; --icon-2: ü™©; background-color: var(--color-aqua);">
		<h1 data-group="Act II">The Glossy Button</h1>
	</header>

	<article class="slide" data-insert="#variables-as-api"></article>

	<article class="recording slide">
		<div class="browser">
			<video src="videos/tag-wc-guidelines.mp4"></video>
		</div>
	</article>

	<article class="website slide">
		<h1>CSS variables as API? <a href="https://shoelace.style/components/button?id=sizes" target="shoelace_button" class="go">‚û°Ô∏è</a></h1>

		<div class="browser"><iframe src="https://shoelace.style/components/button" frameborder="0" name="shoelace_button"></iframe></div>
	</article>

	<article class="slide">
		<h1>Future: Style container queries</h1>
		<pre><code>
			@container style(--glossy: on) {
				button {
					box-shadow: 0 .1em hsl(0 0% 100% / .4) inset;
					/* ... */
				}
			}
		</code></pre>
	</article>

	<article class="minimal demo slide no heading-2x1" id="button-glossy-api" data-type="The API">
		<textarea class="language-html">
			<button>Click me</button>
			<button>Click me</button>
			<button>Click me</button>
			<button>Click me</button>
		</textarea>
		<textarea class="language-css">
			button:nth-child(even) {
				--glossy: var(--ON);
			}

			button:nth-child(n + 3) {
				--color: #f06;
			}
		</textarea>
		<style class="demo" data-slide media="not all">
			.slide {
				--ON: initial;
				--OFF: ;
				--glossy: var(--OFF);
			}

			button {
				--_color: var(--color, black);
				border: var(--glossy, .05em solid var(--_color));
				background: var(--glossy, linear-gradient(hsl(0 0% 100% / .4), transparent)) var(--_color);
				box-shadow: var(--glossy, 0 .1em hsl(0 0% 100% / .4) inset);
				line-height: calc(1.5 var(--glossy, - .4));
			}

			button:hover {
				background-image: linear-gradient(
					hsl(0 0% 100% / calc(.3 var(--glossy, + .3))),
					hsl(0 0% 100% / calc(.3 var(--glossy, - .1)))
				);
			}

			button {
				border-radius: .3em;
				padding: .1em .5em .15em;
				font-size: 180%;
				margin: .2em;
				cursor: pointer;
				font-weight: normal;
				color: white;
			}
		</style>
	</article>

	<article class="minimal demo slide" id="space-toggle">
		<button>Space Toggle</button>
		<textarea class="language-css">
			button {
				--glossy: ;
				background: var(--glossy, linear-gradient(#fff9, #0000)) #f06;
			}
		</textarea>
	</article>

	<article class="minimal demo slide" id="space-toggle-math">
		<button>Space Toggle</button>
		<textarea class="language-css">
			button {
				--glossy: ;
				line-height: calc(1.5 var(--glossy, - .4));
			}
		</textarea>
		<style class="demo">
			button {
				background: #f06;
			}
		</style>
	</article>

	<article class="slide" id="st-numerical">
		<h1>Space Toggle for numerical values</h1>

		<pre><code>
			/* Fictional (future?) syntax: */
			line-height: if(--glossy: on; 1.1; 1.5);

			/* Space toggle version: */
			line-height: calc(1.5 var(--glossy, - .4));
		</code></pre>
	</article>

	<article class="minimal demo slide" id="space-toggle-iacvt">
		<button>Space Toggle</button>
		<textarea class="language-css">
			button {
				--glossy: ;
				border: var(--glossy, .1em solid white);
			}
		</textarea>
		<style class="demo">
			[id^="space-toggle"] button {
				background: #f06;
				border: revert;
			}
		</style>
	</article>

	<article class="fallbacks slide">
		<h1>Fallbacks without variables</h1>

		<pre style="mix-blend-mode: screen;"><code>
			background: hsl(177.3 100% 30.66%);
			background: lch(60% 60 190);
		</code></pre>

		<div class="delayed result" style="background: hsl(177.3 100% 30.66%); background: lch(60% 60 190);"></div>

		<details class="notes">
			To fully understand how this works, we need to understand the concept of Invalid At Computed Value Time (IACVT).
			In pre-variables CSS, When the parser encounters a value it doesn't understand, it can just throw it away.
			This is how we usually get fallbacks: we write two declarations, one with the newer value, and one with older CSS,
			older browsers ignore the newer CSS, newer browsers override the first declaration with the second.
		</details>
	</article>

	<article class="fallbacks slide">
		<h1>Fallbacks with variables?</h1>

		<div class="delayed result transparency" style="background: lch(60% 60 190);"></div>

		<pre><code>
			--color-fallback: hsl(177.3 100% 30.66%);
			--color: lch(60% 60 190);
			<span class="delayed strike">background: var(--color-fallback);</span>
			<span class="delayed iacvt lengthy">background: var(--color);</span> <span class="delayed unset">background: unset;</span>
		</code></pre>

		<details class="notes">
			Can we do the same thing with variables?
			The thing is, variables are resolved later, at computed value time.
			Until then, the browser needs to assume any declaration that includes a variable anywhere could potentially be valid.
			So, here, the first background declaration would just be thrown away.
		</details>
	</article>

	<article class="slide heading-2x4" id="iacvt">
		<h1>Invalid At Computed Value Time (IACVT)</h1>

		<pre><code>
			--foo: 42deg;
			<span class="delayed iacvt">background: var(--foo);</span> <span class="delayed unset">background: unset;</span>
		</code></pre>
		<pre class="delayed"><code>
			--foo: ;
			<span class="delayed iacvt">background: var(--foo);</span> <span class="delayed unset">background: unset;</span>
		</code></pre>
		<pre class="delayed"><code>
			<span class="delayed iacvt">background: var(--foo);</span> <span class="delayed unset">background: unset;</span>
		</code></pre>
		<pre class="delayed"><code>
			--foo: initial;
			<span class="delayed iacvt">background: var(--foo);</span> <span class="delayed unset">background: unset;</span>
		</code></pre>
		<pre class="delayed"><code>
			<span class="delayed iacvt">background: red var(--foo);</span><div class="delayed unset">background: unset;</div>
		</code></pre>

		<pre class="delayed"><code>
			<span class="delayed iacvt">--foo: var(--bar);</span> <span class="delayed unset">--foo: unset;</span>
			<span class="delayed iacvt">--bar: var(--foo);</span> <span class="delayed unset">--bar: unset;</span>
		</code></pre>
		<pre class="delayed"><code>
			<span class="delayed iacvt">--foo: calc(var(--foo) + 1);</span> <span class="delayed unset">--foo: unset;</span>
		</code></pre>

		<pre class="delayed"><code>
			<span class="delayed iacvt">background: var(--foo, 42deg);</span> <div class="delayed unset">background: unset;</div>
		</code></pre>


		<details class="notes">
			IACVT comes into play not just when the browser doesn't understand a property value after substitution,
			but also when the property value is blank, when one or more variable values are missing,
			or when there are cycles. Also, the fallback can make a declaration IACVT as well.
		</details>
	</article>

	<article class="fallbacks slide">
		<h1>Fallbacks with variables</h1>

		<div class="delayed result" style="background: hsl(177.3 100% 30.66%); background: lch(60% 60 190);"></div>

		<pre><code>
			--color: hsl(177.3 100% 30.66%);

			@supports (background: lch(0% 0 0 )) {
				--color: lch(60% 60 190);
			}

			background: var(--color);
		</code></pre>

		<details class="notes">
			Can we do the same thing with variables?
			The thing is, variables are resolved later, at computed value time.
			Until then, the browser needs to assume any declaration that includes a variable anywhere could potentially be valid.
			So, here, the first background declaration would just be thrown away.
		</details>
	</article>

	<article class="slide" id="space-toggle-prod">
		<h1>Space toggle in production</h1>

		<div class="side-by-side">
			<div class="file">
				<span class="name">design-system.css</span>
				<pre><code>
					:root {
						--ON: initial;
						--OFF: ;
					}
				</code></pre>
			</div>
			<div class="file">
				<span class="name">website.css</span>
				<pre><code>
					button.primary {
						--glossy: var(--ON);
					}
				</code></pre>
			</div>
		</div>
	</article>





	<!-- <article class="isolated demo slide" id="button-glossy-implementation" style="--division: 78" data-replayer-delay="1" xdata-replayer-pauses="ignore">
		<textarea class="language-html">
			<button>Click me</button>
			<button>Click me</button>
			<button>Click me</button>
			<button>Click me</button>
		</textarea>
		<textarea class="language-css">
			:root { --glossy: ; /* off */ }
			button:nth-child(even) { --glossy: initial; /* on */ }
			button:nth-child(n + 3) { --color: #f06; }

			button {
				--_color: var(--color, black);
				border: none;
				background: var(--_color);
				line-height: 1.5;
			}

			button:nth-child(even) {
				border: .05em solid var(--_color);
				background: linear-gradient(hsl(0 0% 100% / .4), transparent) var(--_color);
				box-shadow: 0 .1em hsl(0 0% 100% / .4) inset;
				line-height: 1.1;
			}

			button:hover {
				background-image: linear-gradient(
					hsl(0 0% 100% / .3),
					hsl(0 0% 100% / .3)
				);
			}

			button:nth-child(even):hover {
				background-image: linear-gradient(
					hsl(0 0% 100% / .6),
					hsl(0 0% 100% / .2)
				);
			}
		</textarea>
		<style class="demo" data-slide media="not all">
			button {
				border-radius: .3em;
				padding: .1em .5em .15em;
				font-size: 180%;
				margin: .2em;
				cursor: pointer;
				font-weight: normal;
				color: white;
			}
		</style>
		<script class="demo-script" type="application/json">
			[
				{"type":"caret","start":311,"end":360,"editor":"css"},{"type":"pause","delay":2147},{"type":"caret","position":200},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":204},{"type":"insertText","text":"--glossy","split":true},{"type":"pause","delay":1076},{"type":"insertText","text":", ","split":true},{"type":"insertText","text":"linear-gradient(hsl(0 0% 100% / .4), transparent)"},{"type":"caret","position":264},{"type":"insertText","text":" "},
				{"type":"pause","delay":2076},{"type":"caret","start":363,"end":440},{"type":"pause","delay":1047},{"type":"deleteContentBackward","repeat":2},

				{"type":"pause"},{"type":"caret","start":364,"end":409,"editor":"css"},{"type":"pause","delay":2525},{"type":"caret","position":279},{"type":"insertText","text":"\n\t","split":true},{"type":"insertText","text":"box-shadow: 0 .1em hsl(0 0% 100% / .4) inset;"},{"type":"pause","delay":1738},{"type":"caret","position":293},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":297},{"type":"insertText","text":"--glossy, ","split":true},{"type":"caret","start":307,"end":308},{"type":"deleteContentBackward"},{"type":"caret","position":339},{"type":"insertText","text":")"},{"type":"pause","delay":2999},{"type":"caret","start":424,"end":471},{"type":"deleteContentBackward"},

				{"type":"pause"},{"type":"caret","start":390,"end":424},{"type":"pause","delay":2390},{"type":"deleteByCut"},{"type":"caret","start":389,"end":390},{"type":"deleteContentBackward","repeat":2},{"type":"pause","delay":1251},{"type":"caret","start":173,"end":186},{"type":"pause","delay":1047},{"type":"insertText","text":"border: .05em solid var(--_color);"},{"type":"pause","delay":1587},{"type":"caret","start":181,"end":206},{"type":"insertText","text":"(.05em solid var(--_color))"},{"type":"caret","position":181},{"type":"pause","delay":1122},{"type":"caret","position":181},{"type":"insertText","text":"var","split":true},{"type":"caret","position":185},{"type":"insertText","text":"--glossy, ","split":true},

				{"type":"pause"},{"type":"caret","start":392,"end":395,"editor":"css"},{"type":"insertText","text":"(1.5)"},{"type":"caret","position":392},{"type":"insertText","text":"calc","split":true},{"type":"caret","position":400},{"type":"pause","delay":1000},{"type":"insertText","text":" var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":405},{"type":"insertText","text":"--","split":true},{"type":"pause","delay":1061},{"type":"insertText","text":"go","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"lossy, ","split":true},{"type":"pause","delay":1331},{"type":"insertText","text":"-"},{"type":"pause","delay":1108},{"type":"insertText","text":" .4","split":true},{"type":"pause","delay":2000},{"type":"caret","start":451,"end":469},{"type":"pause","delay":1000},{"type":"deleteContentBackward","repeat":2},{"type":"caret","start":424,"end":452},{"type":"pause","delay":1500},{"type":"deleteContentBackward"},

				{"type":"pause"},{"type":"caret","editor":"css","position":495},{"type":"pause","delay":1474},{"type":"caret","start":495,"end":497},{"type":"pause","delay":2656},{"type":"caret","start":392,"end":421},{"type":"pause","delay":2468},{"type":"caret","position":495},{"type":"pause","delay":2071},{"type":"caret","start":495,"end":497},{"type":"insertText","text":"calc(1.5 var(--glossy, - .4))"},{"type":"caret","start":500,"end":503},{"type":"insertText","text":".3","split":true},{"type":"pause","delay":1329},{"type":"caret","start":517,"end":521},{"type":"insertText","text":"+ .3","split":true},{"type":"pause","delay":2000},{"type":"caret","start":495,"end":523},{"type":"pause","delay":1500},{"type":"caret","start":544,"end":546},{"type":"pause","delay":2000},{"type":"insertText","text":"calc(.3 var(--glossy, + .3))"},{"type":"pause","delay":1500},{"type":"caret","start":566,"end":567},{"type":"insertText","text":"-"},{"type":"caret","start":569,"end":570},{"type":"insertText","text":"1"},{"type":"pause","delay":1524},{"type":"caret","start":580,"end":698},{"type":"pause","delay":1040},{"type":"deleteContentBackward","repeat":2},

				{"type":"pause"},{"type":"caret","editor":"css","position":8},{"type":"insertText","text":"\n\t","split":true},{"type":"pause","delay":1851},{"type":"caret","position":32},{"type":"insertText","text":"\n\t","split":true},{"type":"pause","delay":2023},{"type":"caret","position":8},{"type":"insertText","text":"\n\t--ON: initial;\n\t--OFF: ;","split":true},{"type":"pause","delay":1594},{"type":"caret","position":46},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":50},{"type":"insertText","text":"--o","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"OFF","split":true},{"type":"pause","delay":1341},{"type":"caret","start":107,"end":114},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":111},{"type":"insertText","text":"--ON","split":true},

				{"type":"pause"},{"type":"caret","editor":"css","position":8},{"type":"insertText","text":"\n\t","split":true},{"type":"pause","delay":1936},{"type":"caret","position":32},{"type":"insertText","text":"\n\t","split":true},{"type":"deleteContentBackward"},{"type":"caret","position":8},{"type":"insertText","text":"\n\t--ON: initial;\n\t--OFF: ;","split":true},{"type":"pause","delay":1687},{"type":"caret","position":46},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":50},{"type":"insertText","text":"--OFF","split":true},{"type":"caret","start":57,"end":68},{"type":"deleteContentBackward"},{"type":"pause","delay":1665},{"type":"caret","start":95,"end":102},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":99},{"type":"insertText","text":"--ON","split":true},{"type":"caret","start":105,"end":114},{"type":"deleteContentBackward"}
			]
		</script>
	</article> -->

	<article class="slide" id="gradient-interpolation">
		<h1>Gradient interpolation in color space</h1>
		<pre><code>
			.foo {
				background: linear-gradient(#f00, #0f0);
			}

			@supports (background: linear-gradient(in lab, red, tan)) {
				.foo {
					background: linear-gradient(in lab, #f00, #0f0);
				}
			}
		</code></pre>
		<div class="gradient srgb">
			<img src="../reusable/img/chrome-logo.svg" alt="">
		</div>
		<div class="gradient oklab">
			<img src="../reusable/img/safari-logo.png" alt="">
		</div>
	</article>

	<article class="slide" id="gradient-interpolation-st">
		<h1>Space Toggle for progressive enhancement</h1>
		<pre><code>
			:root {
				--in-lab: ;
			}

			@supports (background: linear-gradient(in lab, red, tan)) {
				:root {
					--in-lab: in lab, ;
				}
			}

			.foo {
				background: linear-gradient(var(--in-lab) #f00, #0f0);
			}
		</code></pre>
		<div class="gradient srgb">
			<img src="../reusable/img/chrome-logo.svg" alt="">
		</div>
		<div class="gradient oklab">
			<img src="../reusable/img/safari-logo.png" alt="">
		</div>
		<details class="notes">
			[Tweet](https://twitter.com/LeaVerou/status/1532035426805878784)
		</details>
	</article>

	<article class="slide">
		<h1>Extreme Space Toggle</h1>
		<a href="https://codetea.com/minesweeper-implemented-in-css-html-using-the-space-toggle-trick/"><img src="img/css-sweeper.png" alt=""></a>
		<p class="credit">Made by [Jane Ori](https://twitter.com/Jane0ri)</p>
	</article>
</section>

<section>
	<header class="part slide" style="--icon: üìä; background-color: var(--color-yellow);  --group-background: var(--accent4)">
		<h1 data-group="Act III">The Bar Chart</h1>
	</header>

	<article class="minimal demo slide no heading-2x1" data-type="The API">
		<style data-slide media="not all">
			@import url("css/bar-chart.css");
		</style>
		<textarea class="language-html">
			<div class="bar-chart">
				<div style="--p: 10">A</div>
				<div style="--p: 100">B</div>
				<div style="--p: 95">C</div>
				<div style="--p: 38">D</div>
				<div style="--p: 84.21">E</div>
				<div style="--p: 49">F</div>
			</div>
		</textarea>
	</article>

	<article class="isolated dark demo slide no heading-2x1" id="bar-chart-implementation" style="--division: 60">
		<textarea class="language-html">
			<div class="bar-chart">
				<div style="--p: 10%">A</div>
				<div style="--p: 100%">B</div>
				<div style="--p: 95%">C</div>
				<div style="--p: 38%">D</div>
				<div style="--p: 84.21%">E</div>
				<div style="--p: 49%">F</div>
			</div>
		</textarea>
		<textarea class="language-css">
			.bar-chart > div {
				height: var(--p);
			}
		</textarea>
		<style class="demo" data-slide media="not all">
			@import url("css/bar-chart-base.css");
		</style>
		<script class="demo-script" type="application/json">
			[
				{"type":"caret","start":39,"end":39,"editor":"css"},{"type":"insertText","text":"\n\n.bar-chart > div ","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"::before ","split":true},"{}",{"type":"caret","start":67,"end":67},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","start":68,"end":68},{"type":"insertText","text":"\tcontent: var","split":true},"()",{"type":"caret","start":82,"end":82},{"type":"insertText","text":"--p","split":true},{"type":"caret","start":86,"end":86},";",
				{"type":"pause","delay":5000},{"type":"caret","start":45,"end":45,"editor":"html"},{"type":"deleteContentBackward"},{"type":"caret","start":76,"end":76},{"type":"deleteContentBackward"},{"type":"caret","start":106,"end":106},{"type":"deleteContentBackward"},{"type":"caret","start":136,"end":136},{"type":"deleteContentBackward"},{"type":"caret","start":169,"end":169},{"type":"deleteContentBackward"},{"type":"caret","start":199,"end":199},{"type":"deleteContentBackward"},
				{"type":"caret","start":28,"end":36,"editor":"css"},"(var(--p))",{"type":"caret","start":28,"end":28},{"type":"insertText","text":"calc","split":true},{"type":"caret","start":41,"end":41},{"type":"insertText","text":" * 1%","split":true},
				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause","delay":5000},{"type":"caret","start":78,"end":78},{"type":"insertText","text":"\n\tcounter-reset: p var","split":true},"()",{"type":"caret","start":101,"end":101},{"type":"insertText","text":"--p","split":true},{"type":"caret","start":105,"end":105},{"type":"insertText","text":";","split":true},
				{"type":"caret","start":117,"end":125},{"type":"insertText","text":"counter","split":true},"()",{"type":"caret","start":125,"end":125},"p", {"type":"caret","start":127,"end":127}," ","\"\"",{"type":"caret","start":129,"end":129}," ",{"type":"deleteContentBackward"},"%",
				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause"},{"type":"next_slide"},
				{"type":"pause"},{"type":"caret","start":0,"end":0,"editor":"css"},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","start":0,"end":0},{"type":"insertText","text":"@property --integer ","split":true},"{}",{"type":"caret","start":21,"end":21},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","start":22,"end":22},{"type":"insertText","text":"\tsyntax","split":true},{"type":"insertText","text":": ","split":true},"\"\"",{"type":"caret","start":32,"end":32},{"type":"insertText","text":"<integer>","split":true},{"type":"caret","start":42,"end":42},{"type":"insertText","text":";\n\tinitial-value: 0;\n\tinherits: true;","split":true},
				{"type":"pause"},{"type":"caret","start":161,"end":161,"editor":"css"},{"type":"insertText","text":"\n\t--integer: calc","split":true},"()",{"type":"caret","start":179,"end":179},{"type":"insertText","text":"var","split":true},"()",{"type":"caret","start":183,"end":183},{"type":"insertText","text":"--p","split":true},{"type":"caret","start":188,"end":188},";",{"type":"caret","start":215,"end":215},{"type":"deleteContentBackward"},{"type":"insertText","text":"integer","split":true},

				{"type":"pause"},{"type":"next_slide"},

				{"type":"pause"},{"type":"caret","start":131,"end":131,"editor":"css"},{"type":"insertText","text":"\n\t","split":true},{"type":"insertText","text":"--h","split":true},{"type":"insertText","text":": ; /* ","split":true},{"type":"insertText","text":"50 to 190 */","split":true},{"type":"caret","position":138},{"type":"insertText","text":"calc","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":143},{"type":"pause","delay":1500},{"type":"insertText","text":"50 + ","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":149},{"type":"insertText","text":"190 - 50","split":true},{"type":"pause","delay":1222},{"type":"caret","position":158},{"type":"insertText","text":" * var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":165},{"type":"insertText","text":"--p","split":true},{"type":"caret","position":169},{"type":"insertText","text":" / 100","split":true},{"type":"pause","delay":2667},{"type":"caret","position":193},{"type":"pause","delay":1168},{"type":"insertText","text":"\n\t","split":true},{"type":"pause","delay":1587},{"type":"insertText","text":"--l: calc","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":205},{"type":"insertText","text":");","split":true},{"type":"deleteContentBackward","repeat":2},{"type":"caret","position":206},{"type":"insertText","text":"; /* ","split":true},{"type":"pause","delay":1265},{"type":"insertText","text":"50% to 40% */","split":true},{"type":"pause","delay":1651},{"type":"caret","position":205},{"type":"pause","delay":1160},{"type":"insertText","text":"50%","split":true},{"type":"pause","delay":1728},{"type":"insertText","text":" + ","split":true},{"type":"pause","delay":1624},{"type":"insertText","text":"()"},{"type":"caret","position":212},{"type":"pause","delay":1555},{"type":"insertText","text":"40% - 50%","split":true},{"type":"pause","delay":1197},{"type":"caret","position":222},{"type":"insertText","text":" * ","split":true},{"type":"pause","delay":2201},{"type":"caret","start":161,"end":175},{"type":"pause","delay":1033},{"type":"caret","position":225},{"type":"insertText","text":"var(--p) / 100"},{"type":"pause","delay":2512},{"type":"caret","position":258},{"type":"insertText","text":"\n\tbackground: hsl","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":276},{"type":"pause","delay":1165},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":280},{"type":"insertText","text":"--h","split":true},{"type":"pause","delay":1089},{"type":"caret","position":284},{"type":"insertText","text":" 100% var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":294},{"type":"insertText","text":"--l","split":true},{"type":"caret","position":299},{"type":"insertText","text":";"}
			]
		</script>
	</article>

	<article class="slide">
		<table>
			<tr>
				<td>Number ‚Üí unit: </td>
				<td><code class="language-css">calc(var(--foo) * 1%)</code></td>
			</tr>
			<tr>
				<td>Unit ‚Üí number:</td>
				<td>
					<span class="poop"></span><span class="poop"></span><span class="poop"></span>
					<div class="delayed">
						Future: <code>calc(var(--foo) / 1%)</code>
					</div>
				</td>
			</tr>
		</table>
	</article>

	<article class="takeaway slide">
		<h1>Use variables for pure data, not CSS values</h1>
		<details class="notes">
			This is a good practice regardless of the conversion issues,
			as it ensures better separation of concerns.
		</details>
	</article>

	<article class="slide" data-insert="#bar-chart-implementation"></article>

	<article class="takeaway slide">
		<h1>`content` only accepts strings. You can convert numbers to strings via `counter-reset`.</h1>
		<details class="notes">
			For the same reason, `counter()` returns a string, and thus cannot be used in calculations.
		</details>
	</article>

	<article class="slide" data-insert="#bar-chart-implementation"></article>

	<article class="takeaway slide">
		<h1>`content` only accepts strings. You can convert <del>numbers</del> <ins>integers</ins> to strings via `counter-reset`.</h1>
		<details class="notes">
			For the same reason, `counter()` returns a string, and thus cannot be used in calculations.
		</details>
	</article>

	<article class="left speech slide" style="--character: 'üòû'">
		<h1>The counter trick only works with integers. Sorry!</h1>
	</article>

	<article class="devil speech slide">
		<h1>But what if we convert the number to an integer?</h1>
	</article>

	<article class="slide" data-insert="#bar-chart-implementation"></article>

	<article class="takeaway slide">
		<h1>Convert a number to an integer by assigning it to a property registered as `"&lt;integer>"` inside `calc()`</h1>
	</article>

	<article class="slide">
		<pre><code>
			/* Round: */
			--integer: calc(var(--number));

			/* Floor: */
			--integer: calc(var(--number) - 0.5);

			/* Ceil: */
			--integer: calc(var(--number) + 0.5);
		</code></pre>
		<p class="credit">Credit to [Ana Tudor](https://twitter.com/anatudor/status/1399849494628425734) for discovering this trick.</p>
		<details class="notes">
			[CSS Values 4](https://www.w3.org/TR/css-values-4/) includes a
			[`round()` function](https://www.w3.org/TR/css-values-4/#round-func) for this,
			that can also do lengths etc and rounds by arbitrary steps,
			but it is not currently implemented anywhere.
		</details>
	</article>

	<article class="slide">
		<h1>Future:</h1>

		<pre><code>
			/* Round: */
			counter-reset: p round(var(--p), 1);

			/* Floor: */
			counter-reset: p round(down, var(--p), 1);

			/* Ceil: */
			counter-reset: p round(up, var(--p), 1);
		</code></pre>
	</article>

	<article class="slide">
		<h1>Farther future:</h1>

		<pre><code>
			content: text(var(--p)) "%";
		</code></pre>
	</article>

	<article class="slide" id="bar-colors">
		<div class="gradient"></div>
		<div class="point fill-color" style="--p: 0">
			<code>hsl(50 100% 50%)</code>
		</div>
		<div class="point animate delayed" style="--p: 50">
			<code>hsl(<span class="hue"></span> 100% <span class="sat"></span>&shy;)</code>
		</div>
		<div class="point end fill-color" style="--p: 100">
			<code>hsl(190 100% 40%)</code>
		</div>
		<pre class="delayed equations"><code>
			<!-- --h: calc( 50 + 140 * var(--p) / 100);
			--l: calc(50% - 10% * var(--p) / 100); -->
		</code></pre>
	</article>

	<article class="slide" data-insert="#bar-chart-implementation"></article>

	<article class="slide" id="linear-mapping">
		<h1>Linear mapping</h1>

		<div style="font-weight: 400"><code>--x</code> ‚àà [<span class="x1">x1</span>, <span class="x2">x2</span> ] ‚áí <code>--y</code> ‚àà [<span class="y1">y1</span>, <span class="y2">y2</span>]</div>
		<pre class="delayed"><code>
			--y: calc(( ( (var(--x) - <span class="x1">x1</span>) * (<span class="y2">y2</span> - <span class="y1">y1</span>) ) / (<span class="x2">x2</span> - <span class="x1">x1</span>) ) + <span class="y1">y1</span>);
		</code></pre>
	</article>

	<article class="iframe slide" data-src="https://css.land/ranges"></article>

	<article class="slide">
		<div class="bar-colors-gradient"></div>
		<h1>Color interpolation</h1>

		<div>
			<pre><code>
				/* Now: */
				--h: calc(50 + (190 - 50) * var(--p) / 100); /* 50 to 190 */
				--l: calc(50% + (40% - 50%) * var(--p) / 100); /* 50% to 40% */
				background: hsl(var(--h) 100% var(--l));
			</code></pre>
			<pre class="delayed"><code>
				/* Near future: */
				background: color-mix(in hsl,
					hsl(50 100% 50%),
					hsl(190 100% 40%) calc(var(--p) * 1%)
				);
			</code></pre>
		</div>
	</article>

	<article class="slide takeaway">
		<h1>CSS Variable Conditionals</h1>
		<pre><code>
			--is-not-foo: calc(1 - var(--is-foo));
			property: calc(
				var(--is-foo)     * value_if_true +
				var(--is-not-foo) * value_if_false
			);
		</code></pre>

		<details class="notes">
			You can use linear mapping to do conditionals in a more readable way than space toggle.
			Essentially you're just mapping the 0 to 1 range
			and ignoring all values that are not 0 or 1.
		</details>
	</article>

	<article class="slide">
		<h1>Linear mapping for conditionals</h1>

		<pre><code>
			/* Fictional (future?) syntax: */
			line-height: if(--glossy: 1; 1.1; 1.5);

			/* Space toggle version: */
			line-height: calc(1.5 var(--glossy, - .4));

			<span class="delayed">/* Linear mapping version: */
			--not-glossy: calc(1 - var(--glossy));
			line-height: calc(
				var(--glossy)       * 1.1 +
				var(--not-glossy)   * 1.5
			);</span>
		</code></pre>
	</article>

	<article class="slide">
		<h1>Logical operations</h1>

		<div class="delayed-children">
			<pre><code>--not-a: calc(1 - var(--a));</code></pre>
			<pre><code>--a-and-b: calc(var(--a) * var(--b));</code></pre>
			<pre><code>--a-or-b: min(var(--a) + var(--b), 1);</code></pre>
		</div>


		<details class="notes">
			Interested in finding out more about ways to work around conditionals in CSS?

			Here are a few good articles:
			- [DRY Switching with CSS Variables: The Difference of One Declaration](https://css-tricks.com/dry-switching-with-css-variables-the-difference-of-one-declaration/) by Ana Tudor
			- [DRY State Switching With CSS Variables: Fallbacks and Invalid Values](https://css-tricks.com/dry-state-switching-with-css-variables-fallbacks-and-invalid-values/) by Ana Tudor
			- [Logical Operations with CSS Variables](https://css-tricks.com/logical-operations-with-css-variables/) by Ana Tudor
			- [CSS Switch-Case Conditions](https://css-tricks.com/css-switch-case-conditions/) by Yair Even Or
		</details>
	</article>

	<article class="slide takeaway">
		<h1>Linear mapping allows the same variable to control multiple things, continously or discretely</h1>
		<details class="notes">
			Useful for exposing a nice API or simply for minimizing the number of properties you need to register
		</details>
	</article>

	<article class="isolated horizontal demo slide" id="svg-eyes">
		<textarea class="language-css">
			.iris {
				cx: 50px;
			}
		</textarea>
		<textarea class="language-html">
			<svg viewBox="0 0 250 100">
				<clipPath id="white-clip">
					<path id="white-path" d="M1,50 a65,80 0 0,1 100,0 a80,80 0 0,1 -100,0 Z" />
				</clipPath>
				<use id="eye-white" href="#white-path" />
				<use href="#eye-white" x="148" />
				<circle id="iris" class="iris" cx="50" cy="45" r="18" clip-path="url(#white-clip)" />
				<use class="iris" href="#iris" x="148" />
			</svg>
		</textarea>
		<textarea class="language-js">

		</textarea>
		<style data-slide media="not all" class="demo">
			:root {
				background: hsl(20, 40%, 70%);
			}

			svg {
				width: 90vw;
			}

			#eye-white {
				fill: white;
			}

			.iris {
				stroke: hsl(200, 50%, 50%);
				stroke-width: 14;
				fill: black;
			}

			.second-eye {
				x: 150px;
			}
		</style>
		<script class="demo-script" type="application/json">
			[{"type":"caret","editor":"css","position":7},{"type":"insertText","text":"\n\t--look: .5;","split":true},{"type":"pause","delay":1182},{"type":"caret","start":26,"end":30},{"type":"insertText","text":"(50px)"},{"type":"caret","position":26},{"type":"insertText","text":"calc","split":true},{"type":"caret","position":31},{"type":"insertText","text":"25px + ","split":true},{"type":"caret","position":42},{"type":"insertText","text":" * var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":49},{"type":"insertText","text":"--look","split":true},{"type":"pause","delay":3941},{"type":"caret","position":18},{"type":"pause","delay":1197},{"type":"caret","start":18,"end":19},{"type":"insertText","text":"1"},{"type":"pause","delay":1422},{"type":"caret","start":17,"end":19},{"type":"insertText","text":"0"},{"type":"pause","delay":1380},{"type":"caret","start":17,"end":18},{"type":"insertText","text":"1"},{"type":"caret","start":17,"end":18},{"type":"insertText","text":".5","split":true},

			{"type": "pause"},
			{"type":"caret","start":0,"end":0,"editor":"js"},{"type":"insertText","text":"let root = document.documentElement;\n\ndocument.addEventListener","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":64},{"type":"insertText","text":"\"\""},{"type":"caret","position":65},{"type":"insertText","text":"pointermove","split":true},{"type":"caret","position":77},{"type":"insertText","text":", evt => ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":87},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":91},{"type":"insertText","text":";"},{"type":"caret","position":88},{"type":"insertText","text":"\troot.style.a","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"setProperty","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":112},{"type":"insertText","text":"\"\""},{"type":"caret","position":113},{"type":"insertText","text":"--mouse-x","split":true},{"type":"caret","position":123},{"type":"insertText","text":", evt.clientX / evt","split":true},{"type":"deleteContentBackward","repeat":3},{"type":"insertText","text":"innerWidth","split":true},{"type":"caret","position":150},{"type":"insertText","text":";"},{"type":"pause","delay":1016},{"type":"caret","position":151},{"type":"insertText","text":"\n\t","split":true},{"type":"insertText","text":"root.style.setProperty(\"--mouse-x\", evt.clientX / innerWidth);"},{"type":"pause","delay":1260},{"type":"caret","start":185,"end":186},{"type":"insertText","text":"y"},{"type":"caret","start":199,"end":200},{"type":"insertText","text":"Y"},{"type":"pause","delay":1266},{"type":"caret","start":208,"end":213},{"type":"insertText","text":"Height","split":true},{"type":"pause","delay":2203},{"type":"key","event":"keydown","key":"Enter","code":"Enter","altKey":false,"shiftKey":false,"ctrlKey":false,"metaKey":true},{"type":"pause","delay":2000},{"type":"caret","editor":"css","position":55},{"type":"pause","delay":1750},{"type":"caret","start":17,"end":19},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":21},{"type":"insertText","text":"--mouse-x","split":true}
			]
		</script>
		<details class="notes">
			Using variables for data also helps make code more readable.
			It makes much more sense to change a `--look` variable from
			`0` to `1` than from `25px` to `75px`,
			and affords more flexibility for redesigns.
			However, this means we need to map that number to the value we need
			at the point of usage. How can we do that?
		</details>
	</article>

	<article class="takeaway slide">
		<h1>Range mapping allows you to decouple input from output</h1>
	</article>
</section>
<!--
<section>
	<header class="part slide" style="--icon: üóØ; --icon-2: üí¨; background-color: var(--accent4);">
		<h1 data-group="Act IV">The Speech Bubble</h1>
	</header>

	<article class="api minimal demo slide" id="speech-bubble-api" data-type="The API">
		<textarea class="language-html">
			<blockquote class="devious speech-bubble">
				But what if ‚Äî just hear me out ‚Äî
				what if you <em>registered</em>
				your custom property?
			</blockquote>
		</textarea>
		<textarea class="language-css">
			.speech-bubble {
				--pointer-width: 1em;
				--pointer-height: 1em;
				--pointer-offset: 1.5em;
			}

			.devious.speech-bubble {
				--character: 'üòà';
				--character-size: 3em;
			}
		</textarea>
		<style class="demo" data-slide media="not all">
			@import url('css/speech-bubble.css');
		</style>
	</article>

	<article class="isolated demo slide" style="--division: 60" id="speech">
		<textarea class="language-css">
			.speech-bubble {
				--pointer-width: 1em;
				--pointer-height: 1em;
				--pointer-offset: 1.5em;
				--character: 'üòà';
				--character-size: 3em;
			}

			.speech-bubble::before { /* Pointer */
				width: var(--pointer-width);
				height: var(--pointer-height);
				right: var(--pointer-offset);
			}

			.speech-bubble::after { /* Character */
				content: var(--character, 'üôÇ');
				margin-top: var(--pointer-height);
				font-size: var(--character-size);
			}
		</textarea>
		<textarea class="language-html">
			<blockquote class="speech-bubble">
				But what if ‚Äî just hear me out ‚Äî what if you
				<em>registered</em> your custom property?
			</blockquote>
		</textarea>
		<style data-slide media="not all" class="demo">
			@import url('css/speech-bubble-base.css');
		</style>
		<script class="demo-script" type="application/json">
			[
				{"type":"caret","start":129,"end":132,"animated_selection":false,"editor":"css"},{"type":"insertText","text":"2em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},{"type":"insertText","text":"1em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},{"type":"insertText","text":"2em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},{"type":"insertText","text":"3em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},{"type":"insertText","text":"4em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},{"type":"pause","delay":1000},{"type":"insertText","text":"3em"},
				{"type":"caret","start":129,"end":132,"animated_selection":false},
				{"type":"pause"},{"type":"caret","position":0},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":0},{"type":"insertText","text":"@property --pointer-height ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":28},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":29},{"type":"insertText","text":"\tsyntax: ","split":true},{"type":"insertText","text":"\"\""},{"type":"caret","position":39},{"type":"insertText","text":"<length>","split":true},{"type":"caret","position":48},{"type":"insertText","text":";\n\tinitial-value: 0;\n\tinherits: true;","split":true}
				]
		</script>
		<details class="notes">
			Here we have a child element (our generated content)
			that needs to size its offset based on the parent font size.
			However, just using the `em` unit doesn‚Äôt help: it refers to its own font size.

			In this case we know how to reset it, but this solution is fragile.
			In other cases we can't do this at all, e.g. if the current font size is set to `0`.
			Can we use a variable set to `1em` on the parent? Let's see what happens.

			The computed value of unregistered properties is the specified value
			with any variables substituted.
			This means that any relative units, such as `em` are resolved at the point of usage,
			not the point of definition.
			Registering the property changes this,
			which means you can use it to grab relative values on any ancestor!
			[Here is the solution](https://codepen.io/leaverou/pen/XWMZewB?editors=1100)
			to this exercise.

			Note that this approach doesn't work with `currentColor`,
			which is resolved at used value time.
		</details>
	</article>

	<article class="takeaway slide">
		<h1>
			Relative values inherit as syntax tokens
			*unless* the property is registered
		</h1>
	</article>

	<article class="takeaway slide">
		<h1>
			Registering a property as `&lt;length>` allows us to pass down
			ancestor font sizes!
		</h1>
	</article>

	<article class="isolated demo slide" style="--division: 60" id="optgroup">
		<textarea class="language-html">
			<select size="5">
				<option value="">None</option>
				<optgroup>
					<option value="avocado">ü•ë Avocado</option>
					<option value="sushi">üç£ Sushi</option>
					<option value="steak">ü•© Steak</option>
					<option value="garlic">üßÑ Garlic</option>
				</optgroup>
			</select>
		</textarea>
		<textarea class="language-css">

		</textarea>
		<style data-slide media="not all" class="demo">
			/* Remove Chrome gap */
			:where(optgroup:not([label]) > option)::before {
				content: "";
			}

			/* Remove Firefox gap */
			:where(optgroup:not([label]) > option) {
				padding-inline-start: 2px;
			}
		</style>
		<script class="demo-script" type="application/json">
			[
				{"type":"caret","start":0,"end":0,"editor":"css"},{"type":"insertText","text":"optgroup ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":10},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":11},{"type":"insertText","text":"\tfont-size: 0;","split":true},{"type":"caret","position":27},{"type":"insertText","text":"\n\noptgroup > * ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":43},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":44},{"type":"insertText","text":"\tfont-size: 1rem;","split":true},
				{"type":"pause","delay":5000},{"type":"caret","position":0},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":0},{"type":"insertText","text":"select ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":8},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":9},{"type":"insertText","text":"\t"},{"type":"insertText","text":"--parent-em: 1em;","split":true},{"type":"pause","delay":1301},{"type":"caret","start":87,"end":91},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":91},{"type":"insertText","text":"--parent-em","split":true},{"type":"pause","delay":5000},{"type":"caret","position":0},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":0},{"type":"insertText","text":"@property --parent-em ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":23},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":24},{"type":"insertText","text":"\tsyntax: ","split":true},{"type":"insertText","text":"\"\""},{"type":"caret","position":34},{"type":"insertText","text":"<length>","split":true},{"type":"caret","position":43},{"type":"insertText","text":";\n\tinitial-value: 0;\n\tinherits: tre","split":true},{"type":"deleteContentBackward"},{"type":"insertText","text":"ue;","split":true},

				{"type":"pause"},{"type":"caret","start":0,"end":83,"editor":"css"},{"type":"deleteContentBackward"},{"type":"pause","delay":2999},{"type":"historyUndo"},
				{"type":"pause"},{"type":"next_slide"},

				{"type":"caret","editor":"css","position":82},{"type":"insertText","text":"\n"},{"type":"insertText","text":"\n@property --no-atproperty-fallback ","split":true},{"type":"insertText","text":"{}"},{"type":"caret","position":120},{"type":"insertText","text":"\n\n","split":true},{"type":"caret","position":121},{"type":"insertText","text":"\tsyntax: ","split":true},{"type":"insertText","text":"\"\""},{"type":"caret","position":131},{"type":"pause","delay":600},{"type":"insertText","text":"*"},{"type":"caret","position":133},{"type":"insertText","text":";\n\tinherits: false;","split":true},{"type":"pause","delay":2000},{"type":"caret","position":183},{"type":"insertText","text":"\n\t--no-atproperty-fallback: 1em;","split":true},{"type":"pause","delay":2000},{"type":"caret","position":242},{"type":"insertText","text":"var","split":true},{"type":"insertText","text":"()"},{"type":"caret","position":246},{"type":"insertText","text":"--no-at","split":true},{"type":"insertText","text":"property","split":true},{"type":"insertText","text":"-fallback","split":true},{"type":"pause","delay":2000},{"type":"caret","start":271,"end":272},{"type":"deleteContentBackward"},{"type":"caret","position":270},{"type":"insertText","text":", 0","split":true}
			]
		</script>
	</article>

	<article class="slide language-javascript">
		<h1>Detect @property support</h1>
		<pre><code>
			if (window.CSSPropertyRule) {
				let root = document.documentElement;
				root.classList.add("supports-atproperty");
			}
		</code></pre>
		<button class="run" onclick="eval(this.previousElementSibling.textContent)">Run</button>
	</article>

	<article class="slide">
		<h1>Usage</h1>
		<pre><code>
			.supports-atproperty optgroup {
				font-size: 0;
			}
		</code></pre>
	</article>

	<article class="slide">
		<h1>Can we detect @property with CSS alone?</h1>
		<pre><code>
			@supports ( ??? ) {
				optgroup {
					font-size: 0;
				}
			}
		</code></pre>
	</article>

	<article class="isolated demo slide" style="--division: 60" id="supports-atproperty">
		<textarea class="language-css">
			@property --color-test {
				syntax: "<color>";
				initial-value: transparent;
				inherits: true;
			}

			@supports (--color-test: 0) {
				/* Does not support @property */
				:root {
					background: red;
				}
			}
		</textarea>
	</article>

	<article class="takeway slide">
		<h1>The syntax of registered properties is only checked at computed value time.</h1>
		<details class="notes">
			From the [spec](https://drafts.css-houdini.org/css-properties-values-api-1/#parsing-custom-properties):

			When parsing a page‚Äôs CSS, UAs commonly make a number of optimizations to help with both speed and memory.

			One of those optimizations is that they only store the properties that will actually have an effect; they throw away invalid properties, and if you write the same property multiple times in a single declaration block, all but the last valid one will be thrown away. (This is an important part of CSS‚Äôs error-recovery and forward-compatibility behavior.)

			This works fine if the syntax of a property never changes over the lifetime of a page. If a custom property is registered, however, it can change its syntax, so that a property that was previously invalid suddenly becomes valid.

			The only ways to handle this are to either store every declaration, even those that were initially invalid (increasing the memory cost of pages), or to re-parse the entire page‚Äôs CSS with the new syntax rules (increasing the processing cost of registering a custom property). Neither of these are very desirable.

			Further, UA-defined properties have their syntax determined by the version of the UA the user is viewing the page with; this is out of the page author‚Äôs control, which is the entire reason for CSS‚Äôs error-recovery behavior and the practice of writing multiple declarations for varying levels of support. A custom property, on the other hand, has its syntax controlled by the page author, according to whatever stylesheet or script they‚Äôve included in the page; there‚Äôs no unpredictability to be managed. Throwing away syntax-violating custom properties would thus only be, at best, a convenience for the page author, not a necessity like for UA-defined properties.
		</details>
	</article>

	<article class="isolated demo slide" style="--division: 60" id="supports-atproperty">
		<textarea class="language-css">
			@property --no-atproperty-fallback {
				syntax: "*";
				inherits: false;
			}

			:root {
				/* Will only inherit if @property is ignored */
				--no-atproperty-fallback: red;
			}

			body {
				background: var(--no-atproperty-fallback, green)
			}
		</textarea>
	</article>

	<article class="slide" data-insert="#optgroup"></article>
</section>
-->
<article class="slide" id="conclusion">
	<h1>Conclusion</h1>
</article>

<article class="slide" id="pile-of-hacks">
	<div class="pile-of-poop">
		<span class="poop"></span><br>
		<span class="poop"></span><span class="poop"></span><br>
		<span class="poop"></span><span class="poop"></span><span class="poop"></span><br>
		<span class="poop"></span><span class="poop"></span><span class="poop"></span><span class="poop"></span>
	</div>
	<h1>Is it all a steaming pile of <del>shit</del> hacks?</h1>
</article>

<article class="slide" id="tradeoffs">
	<h1>
		<span class="operand api">API simplicity</span>
		<span class="gt">></span>
		<span class="operand implementation">Implementation simplicity</span>
	</h1>
	<details class="notes">
		Yes, a lot of these were hacks. That doesn't mean they are always a bad idea.
		It is often preferable to trade higher implementation complexity to gain lower API complexity.
		Implementation can always change; it is much harder to change an API.
		Overcomplicated APIs cause a lot more collective pain than overcomplicated implementations,
		because there are always more API users than API developers.
		So do what you gotta do to expose a nice API.
		Write components whose CSS properties are independent and each control one conceptual thing.
		Write components that can work with whatever CSS you throw at them.
		Write components whose CSS properties can be modified at any point without breakage.
		And if you need to employ hacks to do these things, so be it.

		This is not a license to write crappy code.
		This is about the many cases where you need to make a tradeoff between the two.

		But ultimately, every case is different, and the final decision is yours.
	</details>
</article>

<footer class="dark slide dont-resize">
	<img src="img/mark.svg" class="logo" />
	<h1>Thank you!</h1>
	<img src="img/stickers.jpg" class="stickers delayed" alt="">
	<p class="stickercaption delayed">Stickers! ---></p>
	<ul>
		<li style="--icon: 'üåç'"><a href="http://mavo.io">lea.verou.me</a></li>
		<li style="--icon: '‚úâ'"><a href="mailto:lea@verou.me">lea@verou.me</a></li>
		<li style="--icon: 'üê¶'"><a href="http://twitter.com/leaverou">@leaverou</a></li>
	</ul>
	<p>Slides: <a href="../dynamic-css-secrets">projects.verou.me/talks/dynamic-css-secrets</a></p>
	<p style="font-size: 50%;">This slide deck was entirely built with open web technologies! Slideshow framework: <a href="http://github.com/LeaVerou/inspire.js">inspirejs.org</a></p>
</footer>

<script src="../shared/js/bliss.shy.min.js"></script>
<script src="../shared/js/prism.js"></script>
<script src="https://incrementable.verou.me/incrementable.js" type="module"></script>
<script src="https://inspirejs.org/inspire.mjs" type="module"></script>
<script src="talk.js" type="module"></script>

</body>
</html>
