{"version":3,"sources":["unit.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["/*\n * Mavo Unit: Super class that Scope and Primitive inherit from\n */\n(function($, $$) {\n\nvar _ = Mavo.Unit = $.Class({\n\tabstract: true,\n\textends: Mavo.Node,\n\tconstructor: function(element, mavo, o = {}) {\n\t\tthis.constructor.all.set(this.element, this);\n\n\t\tthis.collection = o.collection;\n\t\tthis.dirty = o.dirty;\n\n\t\tif (this.collection) {\n\t\t\t// This is a collection item\n\t\t\tthis.scope = this.parentScope = this.collection.parentScope;\n\t\t}\n\n\t\tif (!this.fromTemplate(\"computed\", \"required\")) {\n\t\t\tthis.computed = Mavo.is(\"computed\", this.element);\n\t\t\tthis.required = Mavo.is(\"required\", this.element);\n\t\t}\n\n\t\tMavo.hooks.run(\"unit-init-end\", this);\n\t},\n\n\t/**\n\t * Check if this unit is either deleted or inside a deleted scope\n\t */\n\tisDeleted: function() {\n\t\tvar ret = this.deleted;\n\n\t\tif (this.deleted) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !!this.parentScope && this.parentScope.isDeleted();\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar isNull = unit => unit.dirty && !o.dirty ||\n\t\t                     unit.deleted && o.dirty ||\n\t\t                     unit.computed && !o.computed ||\n\t\t                     unit.placeholder;\n\n\t\tif (isNull(this)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Check if any of the parent scopes doesn't return data\n\t\tthis.walkUp(scope => {\n\t\t\tif (isNull(scope)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t},\n\n\tlazy: {\n\t\tclosestCollection: function() {\n\t\t\treturn this.collection ||\n\t\t\t       this.scope.collection ||\n\t\t\t       (this.parentScope? this.parentScope.closestCollection : null);\n\t\t}\n\t},\n\n\tlive: {\n\t\tdeleted: function(value) {\n\t\t\tthis.element.classList.toggle(\"deleted\", value);\n\n\t\t\tif (value) {\n\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\t\t\tthis.elementContents.appendChild(node);\n\t\t\t\t});\n\n\t\t\t\t$.contents(this.element, [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\tclass: \"close\",\n\t\t\t\t\t\ttextContent: \"Ã—\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function(evt) {\n\t\t\t\t\t\t\t\t$.remove(this.parentNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"Deleted \" + this.name,\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\n\t\t\t\tthis.element.classList.remove(\"delete-hover\");\n\t\t\t}\n\t\t\telse if (this.deleted) {\n\t\t\t\t// Undelete\n\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\tthis._deleted = false;\n\n\t\t\t\t$.fire(this.element, \"mavo:datachange\", {\n\t\t\t\t\tunit: this.collection,\n\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\taction: \"undelete\",\n\t\t\t\t\titem: this\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tif (value && (this.placeholder || this.computed || !this.editing)) {\n\t\t\t\tvalue = false;\n\t\t\t}\n\n\t\t\tthis.element.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\treturn value;\n\t\t},\n\n\t\tplaceholder: function(value) {\n\t\t\tthis.element.classList.toggle(\"placeholder\", value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tget: function(element, prioritizePrimitive) {\n\t\t\tvar scope = Mavo.Scope.all.get(element);\n\n\t\t\treturn (prioritizePrimitive || !scope)? Mavo.Primitive.all.get(element) : scope;\n\t\t},\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (!element || !mavo) {\n\t\t\t\tthrow new TypeError(\"Mavo.Unit.create() requires an element argument and a mavo object\");\n\t\t\t}\n\n\t\t\treturn new Mavo[Mavo.is(\"scope\", element)? \"Scope\" : \"Primitive\"](element, mavo, o);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}