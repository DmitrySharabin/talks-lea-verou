!function(){"use strict";function t(e,n,s){return n=void 0===n?1:n,s=s||n+1,1>=s-n?function(){if(arguments.length<=n||"string"===r.type(arguments[n]))return e.apply(this,arguments);var t,s=arguments[n];for(var i in s){var o=Array.from(arguments);o.splice(n,1,i,s[i]),t=e.apply(this,o)}return t}:t(t(e,n+1,s),n,s-1)}function e(t,r,s){var i=n(s);if("string"===i){var o=Object.getOwnPropertyDescriptor(r,s);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?t[s]=r[s]:(delete t[s],Object.defineProperty(t,s,o))}else if("array"===i)s.forEach(function(n){n in r&&e(t,r,n)});else for(var a in r)s&&("regexp"===i&&!s.test(a)||"function"===i&&!s.call(r,a))||e(t,r,a);return t}function n(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var r=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:"string"===r.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(r,{extend:e,overload:t,type:n,property:r.property||"_",sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.from("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?r.set(t,e):(1===arguments.length&&("string"===r.type(t)?e={}:(e=t,t=e.tag,e=r.extend({},e,function(t){return"tag"!==t}))),r.set(document.createElement(t||"div"),e))},each:function(t,e,n){n=n||{};for(var r in t)n[r]=e.call(t,r,t[r]);return n},ready:function(t){return t=t||document,new Promise(function(e,n){"loading"!==t.readyState?e():t.addEventListener("DOMContentLoaded",function(){e()})})},Class:function(t){var e,n=["constructor","extends","abstract","static"].concat(Object.keys(r.classProps)),s=t.hasOwnProperty("constructor")?t.constructor:r.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error("Abstract classes cannot be directly instantiated.");e["super"]&&e["super"].apply(this,arguments),s.apply(this,arguments)},e["super"]=t["extends"]||null,e.prototype=r.extend(Object.create(e["super"]?e["super"].prototype:Object),{constructor:e}),e.prototype["super"]=e["super"]?e["super"].prototype:null,e.__abstract=!!t["abstract"]);var i=function(t){return this.hasOwnProperty(t)&&-1===n.indexOf(t)};if(t["static"]){r.extend(e,t["static"],i);for(var o in r.classProps)o in t["static"]&&r.classProps[o](e,t["static"][o])}r.extend(e.prototype,t,i);for(var o in r.classProps)o in t&&r.classProps[o](e.prototype,t[o]);return e},classProps:{lazy:t(function(t,e,n){return Object.defineProperty(t,e,{get:function(){var t=n.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return"function"===r.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],r=n.get&&n.get.call(this,t);return void 0!==r?r:t},set:function(t){var r=this["_"+e],s=n.set&&n.set.call(this,t,r);this["_"+e]=void 0!==s?s:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length?arguments[0]:!1,n=document.createElement("script");return e?Promise.resolve():new Promise(function(e,s){r.set(n,{async:!0,onload:function(){e(),r.remove(n)},onerror:function(){s()},src:t,inside:document.head})})},fetch:function(t,n){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var s=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);s.method=s.method.toUpperCase(),r.hooks.run("fetch-args",s),"GET"===s.method&&s.data&&(s.url.search+=s.data),document.body.setAttribute("data-loading",s.url),s.xhr.open(s.method,s.url.href,s.async!==!1,s.user,s.password);for(var i in n)if(i in s.xhr)try{s.xhr[i]=n[i]}catch(o){self.console&&console.error(o)}"GET"===s.method||s.headers["Content-type"]||s.headers["Content-Type"]||s.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var a in s.headers)s.xhr.setRequestHeader(a,s.headers[a]);return new Promise(function(t,e){s.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===s.xhr.status||s.xhr.status>=200&&s.xhr.status<300||304===s.xhr.status?t(s.xhr):e(r.extend(Error(s.xhr.statusText),{xhr:s.xhr,get status(){return this.xhr.status}}))},s.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Error"),{xhr:s.xhr}))},s.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Timeout"),{xhr:s.xhr}))},s.xhr.send("GET"===s.method?null:s.data)})},value:function(t){var e="string"!==r.type(t);return r.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),r.Hooks=new r.Class({add:function(t,e,n){(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],this[t][n?"unshift":"push"](e)},this)},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),r.hooks=new r.Hooks;var s=r.property;r.Element=function(t){this.subject=t,this.data={},this.bliss={}},r.Element.prototype={set:t(function(t,e){t in r.setProps?r.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(n,s){if("transition"in this.style){var i=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),r.once(this,"transitionend",function(){clearTimeout(o),r.style(this,i),n(this)});var o=setTimeout(n,e+50,this);r.style(this,t)}else r.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),this.dispatchEvent(r.extend(n,e))},unbind:t(function(t,e){(t||"").split(/\s+/).forEach(function(t){if(s in this&&(t.indexOf(".")>-1||!e)){t=(t||"").split(".");var n=t[1];t=t[0];var r=this[s].bliss.listeners=this[s].bliss.listeners||{};for(var i in r)if(!t||i===t)for(var o,a=0;o=r[i][a];a++)n&&n!==o.className||e&&e!==o.callback||(this.removeEventListener(i,o.callback,o.capture),a--)}else this.removeEventListener(t,e)},this)},0)},r.setProps={style:function(t){r.extend(this.style,t)},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){r.extend(this,t)},events:function(t){if(t&&t.addEventListener){var e=this;if(t[s]&&t[s].bliss){var n=t[s].bliss.listeners;for(var i in n)n[i].forEach(function(t){e.addEventListener(i,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])}else if(arguments.length>1&&"string"===r.type(t)){var a=arguments[1],u=arguments[2];t.split(/\s+/).forEach(function(t){this.addEventListener(t,a,u)},this)}else for(var c in t)r.events(this,c,t[c])},once:t(function(t,e){t=t.split(/\s+/);var n=this,r=function(){return t.forEach(function(t){n.removeEventListener(t,r)}),e.apply(n,arguments)};t.forEach(function(t){n.addEventListener(t,r)})},0),delegate:t(function(t,e,n){this.addEventListener(t,function(t){t.target.closest(e)&&n.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=r.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=r.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t.appendChild(this)},before:function(t){t.parentNode.insertBefore(this,t)},after:function(t){t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t.insertBefore(this,t.firstChild)},around:function(t){t.parentNode&&r.before(this,t),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(t)}},r.Array=function(t){this.subject=t},r.Array.prototype={all:function(t){var e=$$(arguments).slice(1);return this[t].apply(this,e)}},r.add=t(function(t,e,n,s){n=r.extend({$:!0,element:!0,array:!0},n),"function"==r.type(e)&&(!n.element||t in r.Element.prototype&&s||(r.Element.prototype[t]=function(){return this.subject&&r.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in r.Array.prototype&&s||(r.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&r.defined(e.apply(n,t),n)})}),n.$&&(r.sources[t]=r[t]=e,(n.array||n.element)&&(r[t]=function(){var e=[].slice.apply(arguments),s=e.shift(),i=n.array&&Array.isArray(s)?"Array":"Element";return r[i].prototype[t].apply({subject:s},e)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement("_");r.add(r.extend({},HTMLElement.prototype,function(t){return"function"===r.type(i[t])}),null,!0)}(),function(t){"use strict";if(Bliss&&!Bliss.shy){var e=Bliss.property;if(t.add({clone:function(){var e=this.cloneNode(!0),n=t.$("*",e).concat(e);return t.$("*",this).concat(this).forEach(function(e,r,s){t.events(n[r],e),n[r]._.data=t.extend({},e._.data)}),e}},{array:!1}),Object.defineProperty(Node.prototype,e,{get:function o(){return Object.defineProperty(Node.prototype,e,{get:void 0}),Object.defineProperty(this,e,{value:new t.Element(this)}),Object.defineProperty(Node.prototype,e,{get:o}),this[e]},configurable:!0}),Object.defineProperty(Array.prototype,e,{get:function(){return Object.defineProperty(this,e,{value:new t.Array(this)}),this[e]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var n=EventTarget.prototype.addEventListener,r=EventTarget.prototype.removeEventListener,s=function(t,e,n){return n.callback===t&&n.capture==e},i=function(){return!s.apply(this,arguments)};EventTarget.prototype.addEventListener=function(t,r,i){if(this&&this[e]&&this[e].bliss&&r){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};if(t.indexOf(".")>-1){t=t.split(".");var a=t[1];t=t[0]}o[t]=o[t]||[],0===o[t].filter(s.bind(null,r,i)).length&&o[t].push({callback:r,capture:i,className:a})}return n.call(this,t,r,i)},EventTarget.prototype.removeEventListener=function(t,n,s){if(this&&this[e]&&this[e].bliss&&n){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};o[t]&&(o[t]=o[t].filter(i.bind(null,n,s)))}return r.call(this,t,n,s)}}self.$=self.$||t,self.$$=self.$$||t.$}}(Bliss);
/*
 * Stretchy: Form element autosizing, the way it should be.
 * by Lea Verou http://lea.verou.me
 * MIT license
 */
(function() {

if (!self.Element) {
	return; // super old browser
}

if (!Element.prototype.matches) {
	Element.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;
}

if (!Element.prototype.matches) {
	return;
}

function $$(expr, con) {
	return expr instanceof Node || expr instanceof Window? [expr] :
	       [].slice.call(typeof expr == "string"? (con || document).querySelectorAll(expr) : expr || []);
}

var _ = self.Stretchy = {
	selectors: {
		base: 'textarea, select:not([size]), input:not([type]), input[type="' + "text url email tel".split(" ").join('"], input[type="') + '"]',
		filter: "*"
	},

	// Script element this was included with, if any
	script: document.currentScript || $$("script").pop(),

	// Autosize one element. The core of Stretchy.
	resize: function(element) {
		if (!_.resizes(element)) {
			return;
		}

		var cs = getComputedStyle(element);
		var offset = 0;

		if (!element.value && element.placeholder) {
			var empty = true;
			element.value = element.placeholder;
		}

		var type = element.nodeName.toLowerCase();

		if (type == "textarea") {
			element.style.height = "0";

			if (cs.boxSizing == "border-box") {
				offset = element.offsetHeight;
			}
			else if (cs.boxSizing == "content-box") {
				offset = -element.clientHeight;
			}

			element.style.height = element.scrollHeight + offset + "px";
		}
		else if(type == "input") {
			element.style.width = "0";

			if (cs.boxSizing == "border-box") {
				offset = element.offsetWidth;
			}
			else if (cs.boxSizing == "padding-box") {
				offset = element.clientWidth;
			}

			// Safari misreports scrollWidth, so we will instead set scrollLeft to a
			// huge number, and read that back to see what it was clipped to
			element.scrollLeft = 1e+10;

			var width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);

			element.style.width = width + "px";
		}
		else if (type == "select") {
			var selectedIndex = element.selectedIndex > 0? element.selectedIndex : 0;

			// Need to use dummy element to measure :(
			var option = document.createElement("_");
			option.textContent = element.options[selectedIndex].textContent;
			element.parentNode.insertBefore(option, element.nextSibling);

			// The name of the appearance property, as it might be prefixed
			var appearance;

			for (var property in cs) {
				var value = cs[property];
				if (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == "string") {
					//console.log(property, option.offsetWidth, cs[property]);
					option.style[property] = value;

					if (/appearance$/i.test(property)) {
						appearance = property;
					}
				}
			}

			option.style.width = "";

			if (option.offsetWidth > 0) {
				element.style.width = option.offsetWidth + "px";

				if (!cs[appearance] || cs[appearance] !== "none") {
					// Account for arrow
					element.style.width = "calc(" + element.style.width + " + 2em)";
				}
			}

			option.parentNode.removeChild(option);
			option = null;
		}

		if (empty) {
			element.value = "";
		}
	},

	// Autosize multiple elements
	resizeAll: function(elements) {
		$$(elements || _.selectors.base).forEach(function (element) {
			_.resize(element);
		});
	},

	active: true,

	// Will stretchy do anything for this element?
	resizes: function(element) {
		return element &&
		       element.parentNode &&
		       element.matches &&
		       element.matches(_.selectors.base) &&
		       element.matches(_.selectors.filter);
	},

	init: function(){
		_.selectors.filter = _.script.getAttribute("data-filter") ||
		                     ($$("[data-stretchy-filter]").pop() || document.body).getAttribute("data-stretchy-filter") || Stretchy.selectors.filter || "*";

		_.resizeAll();
	},

	$$: $$
};

// Autosize all elements once the DOM is loaded

// DOM already loaded?
if (document.readyState !== "loading") {
	_.init();
}
else {
	// Wait for it
	document.addEventListener("DOMContentLoaded", _.init);
}

// Listen for changes
var listener = function(evt) {
	if (_.active) {
		_.resize(evt.target);
	}
};

document.documentElement.addEventListener("input", listener);

// Firefox fires a change event instead of an input event
document.documentElement.addEventListener("change", listener);

// Listen for new elements
if (self.MutationObserver) {
	(new MutationObserver(function(mutations) {
		if (_.active) {
			mutations.forEach(function(mutation) {
				if (mutation.type == "childList") {
					Stretchy.resizeAll(mutation.addedNodes);
				}
			});
		}
	})).observe(document.documentElement, {
		childList: true,
		subtree: true
	});
}

})();

/* jsep v0.3.1 (http://jsep.from.so/) */
!function(a){"use strict";var b="Compound",c="Identifier",d="MemberExpression",e="Literal",f="ThisExpression",g="CallExpression",h="UnaryExpression",i="BinaryExpression",j="LogicalExpression",k="ConditionalExpression",l="ArrayExpression",m=46,n=44,o=39,p=34,q=40,r=41,s=91,t=93,u=63,v=59,w=58,x=function(a,b){var c=new Error(a+" at character "+b);throw c.index=b,c.description=a,c},y=!0,z={"-":y,"!":y,"~":y,"+":y},A={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},B=function(a){var b,c=0;for(var d in a)(b=d.length)>c&&a.hasOwnProperty(d)&&(c=b);return c},C=B(z),D=B(A),E={"true":!0,"false":!1,"null":null},F="this",G=function(a){return A[a]||0},H=function(a,b,c){var d="||"===a||"&&"===a?j:i;return{type:d,operator:a,left:b,right:c}},I=function(a){return a>=48&&a<=57},J=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=128&&!A[String.fromCharCode(a)]},K=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a>=128&&!A[String.fromCharCode(a)]},L=function(a){for(var i,j,y=0,B=a.charAt,L=a.charCodeAt,M=function(b){return B.call(a,b)},N=function(b){return L.call(a,b)},O=a.length,P=function(){for(var a=N(y);32===a||9===a;)a=N(++y)},Q=function(){var a,b,c=S();return P(),N(y)!==u?c:(y++,a=Q(),a||x("Expected expression",y),P(),N(y)===w?(y++,b=Q(),b||x("Expected expression",y),{type:k,test:c,consequent:a,alternate:b}):void x("Expected :",y))},R=function(){P();for(var b=a.substr(y,D),c=b.length;c>0;){if(A.hasOwnProperty(b))return y+=c,b;b=b.substr(0,--c)}return!1},S=function(){var a,b,c,d,e,f,g,h;if(f=T(),b=R(),!b)return f;for(e={value:b,prec:G(b)},g=T(),g||x("Expected expression after "+b,y),d=[f,e,g];(b=R())&&(c=G(b),0!==c);){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)g=d.pop(),b=d.pop().value,f=d.pop(),a=H(b,f,g),d.push(a);a=T(),a||x("Expected expression after "+b,y),d.push(e,a)}for(h=d.length-1,a=d[h];h>1;)a=H(d[h-1].value,d[h-2],a),h-=2;return a},T=function(){var b,c,d;if(P(),b=N(y),I(b)||b===m)return U();if(b===o||b===p)return V();if(J(b)||b===q)return Y();if(b===s)return $();for(c=a.substr(y,C),d=c.length;d>0;){if(z.hasOwnProperty(c))return y+=d,{type:h,operator:c,argument:T(),prefix:!0};c=c.substr(0,--d)}return!1},U=function(){for(var a,b,c="";I(N(y));)c+=M(y++);if(N(y)===m)for(c+=M(y++);I(N(y));)c+=M(y++);if(a=M(y),"e"===a||"E"===a){for(c+=M(y++),a=M(y),"+"!==a&&"-"!==a||(c+=M(y++));I(N(y));)c+=M(y++);I(N(y-1))||x("Expected exponent ("+c+M(y)+")",y)}return b=N(y),J(b)?x("Variable names cannot start with a number ("+c+M(y)+")",y):b===m&&x("Unexpected period",y),{type:e,value:parseFloat(c),raw:c}},V=function(){for(var a,b="",c=M(y++),d=!1;y<O;){if(a=M(y++),a===c){d=!0;break}if("\\"===a)switch(a=M(y++)){case"n":b+="\n";break;case"r":b+="\r";break;case"t":b+="\t";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+="\x0B";break;default:b+="\\"+a}else b+=a}return d||x('Unclosed quote after "'+b+'"',y),{type:e,value:b,raw:c+b+c}},W=function(){var b,d=N(y),g=y;for(J(d)?y++:x("Unexpected "+M(y),y);y<O&&(d=N(y),K(d));)y++;return b=a.slice(g,y),E.hasOwnProperty(b)?{type:e,value:E[b],raw:b}:b===F?{type:f}:{type:c,name:b}},X=function(a){for(var c,d,e=[],f=!1;y<O;){if(P(),c=N(y),c===a){f=!0,y++;break}c===n?y++:(d=Q(),d&&d.type!==b||x("Expected comma",y),e.push(d))}return f||x("Expected "+String.fromCharCode(a),y),e},Y=function(){var a,b;for(a=N(y),b=a===q?Z():W(),P(),a=N(y);a===m||a===s||a===q;)y++,a===m?(P(),b={type:d,computed:!1,object:b,property:W()}):a===s?(b={type:d,computed:!0,object:b,property:Q()},P(),a=N(y),a!==t&&x("Unclosed [",y),y++):a===q&&(b={type:g,arguments:X(r),callee:b}),P(),a=N(y);return b},Z=function(){y++;var a=Q();return P(),N(y)===r?(y++,a):void x("Unclosed (",y)},$=function(){return y++,{type:l,elements:X(t)}},_=[];y<O;)i=N(y),i===v||i===n?y++:(j=Q())?_.push(j):y<O&&x('Unexpected "'+M(y)+'"',y);return 1===_.length?_[0]:{type:b,body:_}};if(L.version="0.3.1",L.toString=function(){return"JavaScript Expression Parser (JSEP) v"+L.version},L.addUnaryOp=function(a){return C=Math.max(a.length,C),z[a]=y,this},L.addBinaryOp=function(a,b){return D=Math.max(a.length,D),A[a]=b,this},L.addLiteral=function(a,b){return E[a]=b,this},L.removeUnaryOp=function(a){return delete z[a],a.length===C&&(C=B(z)),this},L.removeBinaryOp=function(a){return delete A[a],a.length===D&&(D=B(A)),this},L.removeLiteral=function(a){return delete E[a],this},"undefined"==typeof exports){var M=a.jsep;a.jsep=L,L.noConflict=function(){return a.jsep===L&&(a.jsep=M),L}}else"undefined"!=typeof module&&module.exports?exports=module.exports=L:exports.parse=L}(this);
//# sourceMappingURL=jsep.min.js.map
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t,e){var n=self.Mavo=t.Class({constructor:function(i){var r=this;this.treeBuilt=Mavo.defer(),this.element=i,this.index=n.all.push(this);var s=n.attributes.map(function(t){return"[data-"+t+"]"}),o=!0,a=!1,u=void 0;try{for(var c,l=e(s.join(", "),this.element).concat(this.element)[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value,m=!0,v=!1,d=void 0;try{for(var f,g=n.attributes[Symbol.iterator]();!(m=(f=g.next()).done);m=!0){var p=f.value,b=h.getAttribute("data-"+p);null!==b&&h.setAttribute(p,b)}}catch(y){v=!0,d=y}finally{try{!m&&g["return"]&&g["return"]()}finally{if(v)throw d}}}}catch(y){a=!0,u=y}finally{try{!o&&l["return"]&&l["return"]()}finally{if(a)throw u}}n.allIds.push(this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index),this.element.setAttribute("mv-app",this.id),this.unhandled=this.element.classList.contains("mv-keep-unhandled"),
this.autoEdit=this.element.classList.contains("mv-autoedit"),1==this.index&&(this.storage=n.Functions.urlOption("store"),this.source=n.Functions.urlOption("source")),this.storage=this.storage||n.Functions.urlOption(this.id+"_store")||this.element.getAttribute("mv-storage")||null,this.source=this.source||n.Functions.urlOption(this.id+"_source")||this.element.getAttribute("mv-init")||null,this.storage&&(this.storage=this.storage.trim(),this.storage="none"==this.storage?null:n.Backend.create(this.storage,this)),this.source&&(this.source=n.Backend.create(this.source,this)),this.permissions=this.storage?this.storage.permissions:new Mavo.Permissions,this.element.addEventListener("keydown",function(t){83==t.keyCode&&t[n.superKey]&&(t.preventDefault(),r.save())}),this.element.setAttribute("typeof",""),e(n.selectors.primitive,i).forEach(function(e){var i=t(n.selectors.not(n.selectors.formControl)+", "+n.selectors.property,e);if(i){var r=Mavo.Primitive.getDefaults(e),s=Mavo.is("multiple",e);(s||!Mavo.Primitive.getValueAttribute(e,r)&&!r.hasChildren)&&e.setAttribute("typeof","");
}}),this.ui={bar:t(".mv-bar",this.element)||t.create({className:"mv-bar mv-ui",start:this.element})},this.ui.status=t(".mv-status",this.ui.bar)||t.create("span",{className:"mv-status",inside:this.ui.bar}),this.storage&&(this.authControls={},this.permissions.can("login",function(){r.loginHash="#login"+(Mavo.all[0]===r?"":"-"+r.id),r.authControls.login=t.create({tag:"a",href:r.loginHash,textContent:"Login",className:"mv-login mv-button",events:{click:function(t){t.preventDefault(),r.storage.login()}},after:t(".mv-status",r.ui.bar)});var e;(e=function(){location.hash===r.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),r.storage.login())})(),window.addEventListener("hashchange.mavo",e)},function(){t.remove(r.authControls.login),r.element._.unbind("hashchange.mavo")}),this.element.addEventListener("mavo:login.mavo",function(e){if(e.backend==r.storage){var n=t(".mv-status",r.ui.bar);n.innerHTML="",n._.contents(["Logged in to "+e.backend.id+" as ",{tag:"strong",innerHTML:e.name
},{tag:"button",textContent:"Logout",className:"mv-logout",events:{click:function(t){return e.backend.logout()}}}])}}),this.element.addEventListener("mavo:logout.mavo",function(e){t(".mv-status",r.ui.bar).textContent=""})),t("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(t){t.target!=document.activeElement&&t.preventDefault()}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.needsEdit=this.some(function(t){return"read edit"==t.modes||void 0===t.modes}),this.setUnsavedChanges(!1),this.permissions.onchange(function(t){var e=t.action,n=t.value,i=r.element.getAttribute("mv-permissions")||"";i=i.trim().split(/\s+/).filter(function(t){return t!=e}),n&&i.push(e),r.element.setAttribute("mv-permissions",i.join(" "))}),this.permissions.can(["edit","add","delete"],function(){r.ui.edit=t.create("button",{className:"mv-edit",textContent:"Edit",onclick:function(t){
return r.editing?r.done():r.edit()},inside:r.ui.bar}),r.autoEdit&&r.ui.edit.click()},function(){t.remove(r.ui.edit),r.editing&&r.done()}),this.needsEdit&&this.permissions.can("save",function(){r.ui.save=t.create("button",{className:"mv-save",textContent:"Save",events:{click:function(t){return r.save()},"mouseenter focus":function(t){r.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(t){return r.element.classList.remove("mv-highlight-unsaved")}},inside:r.ui.bar}),r.ui.revert=t.create("button",{className:"mv-revert",textContent:"Revert",disabled:!0,events:{click:function(t){return r.revert()},"mouseenter focus":function(t){r.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(t){return r.element.classList.remove("mv-highlight-unsaved")}},inside:r.ui.bar})},function(){t.remove([r.ui.save,r.ui.revert]),r.ui.save=r.ui.revert=null}),this.permissions.can("delete",function(){r.ui.clear=t.create("button",{className:"mv-clear",textContent:"Clear",onclick:function(t){
return r.clear()}}),r.ui.bar.appendChild(r.ui.clear)}),this.permissions.cannot(["delete","edit"],function(){t.remove(r.ui.clear)}),this.storage||this.source?(this.storage||this.source.permissions.can("read",function(){return r.permissions.read=!0}),this.permissions.can("read",function(){return r.load()})):(this.permissions.on(["read","edit"]),t.fire(this.element,"mavo:load")),this.needsEdit||this.element.addEventListener("mavo:load",function(t){var e=n.debounce(function(){r.save()},3e3),i=function(t){t.node.saved&&e()};requestAnimationFrame(function(){r.permissions.can("save",function(){r.element.addEventListener("mavo:datachange",i)},function(){r.element.removeEventListener("mavo:datachange",i)})})}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},get data(){return this.getData()},getData:function(t){return this.root.getData(t)},toJSON:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];return n.toJSON(t)},error:function i(e){for(var r,s=function(){
return t.transition(i,{opacity:0}).then(t.remove)},i=t.create("p",{className:"mv-error mv-ui",contents:[e,{tag:"button",className:"mv-close mv-ui",textContent:"×",events:{click:s}}],events:{mouseenter:function(t){return clearTimeout(r)},mouseleave:n.rr(function(t){return r=setTimeout(s,5e3)})},start:this.element}),o=arguments.length,a=Array(o>1?o-1:0),u=1;u<o;u++)a[u-1]=arguments[u];if(a.length>0){var c;(c=console).log.apply(c,["%c"+e,"color: red; font-weight: bold"].concat(a))}},render:function(t){n.hooks.run("render-start",{context:this,data:t}),t&&this.root.render(t),this.unsavedChanges=!1,n.hooks.run("render-end",{context:this,data:t})},clear:function(){var t=this;confirm("This will delete all your data. Are you sure?")&&this.store(null).then(function(){return t.root.clear()})},edit:function(){this.root.edit(),t.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(t){if(t.target.matches(".mv-item-controls *")){var e=t.target.closest(n.selectors.item);e.classList.toggle("mv-highlight","mouseenter"==t.type);
}if(t.target.matches(n.selectors.item)){t.target.classList.remove("mv-has-hovered-item");var i=t.target.parentNode.closest(n.selectors.item);i&&i.classList.toggle("mv-has-hovered-item","mouseenter"==t.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(t){var e=!!t;return t||this.walk(function(n){if(n.unsavedChanges)return e=!0,t===!1&&(n.unsavedChanges=!1),!1}),this.unsavedChanges=e},done:function(){this.root.done(),t.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},load:function(){var e=this;this.inProgress="Loading";var n=this.storage||this.source;return n.ready.then(function(){return n.get()})["catch"](function(t){return e.source&&n!==e.source?e.source.ready.then(function(){return e.source.get()}):Promise.reject(t)}).then(function(n){if(n&&"string"==t.type(n))try{n=JSON.parse(n)}catch(i){e.error("The data is corrupted.",i,n),n=""}e.render(n)})["catch"](function(t){t&&(t.xhr&&404==t.xhr.status?e.render(""):e.error("The data could not be loaded.",t))}).then(function(){
e.inProgress=!1,t.fire(e.element,"mavo:load")})},store:function(){var t=this;if(this.storage)return this.inProgress="Saving",this.storage.login().then(function(){return t.storage.put()}).then(function(e){return t.inProgress=!1,e})["catch"](function(e){if(e){var n="Problem saving data";e.status&&e.statusText&&(n+=" (HTTP "+e.status+": "+e.statusText+")"),t.error(n,e)}return t.inProgress=!1,Promise.reject(e)})},save:function(){var e=this;return this.store().then(function(n){n&&(t.fire(e.element,"mavo:save",{data:n.data,dataString:n.dataString}),e.lastSaved=Date.now(),e.root.save(),e.unsavedChanges=!1)})},revert:function(){this.root.revert()},walk:function(t){return this.root.walk(t)},some:function(t){return!this.walk(function(e,n){var i=t(e,n);if(i===!0)return!1})},live:{inProgress:function(e){t.toggleAttribute(this.element,"mv-progress",e,e)},unsavedChanges:function(t){this.element.classList.toggle("mv-unsaved-changes",t),this.ui&&this.ui.save&&(this.ui.save.classList.toggle("mv-unsaved-changes",t),
this.ui.revert.disabled=!t)},needsEdit:function(e){t.toggleAttribute(this.ui.bar,"hidden","",!e)}},"static":{all:[],allIds:[],get:function(t){var e=!0,i=!1,r=void 0;try{for(var s,o=n.all[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var a=s.value;if(a.id===t)return a}}catch(u){i=!0,r=u}finally{try{!e&&o["return"]&&o["return"]()}finally{if(i)throw r}}return null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",init:function(t){return e(n.selectors.init,t||document).filter(function(t){return t==document.documentElement||!t.parentNode.closest(n.selectors.init)}).map(function(t){return new n(t)})},plugin:function(e){for(var i in e.hooks)n.hooks.add(i,e.hooks[i]);for(var r in e.extend)t.Class(Mavo[r],e.extend[r])},hooks:new t.Hooks,attributes:["mv-app","mv-storage","mv-init","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions"]}});!function(){var e=n.selectors={init:".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]",property:"[property], [itemprop]",
specificProperty:function(t){return"[property="+t+"], [itemprop="+t+"]"},group:"[typeof], [itemscope], [itemtype], .mv-group",multiple:"[mv-multiple], .mv-multiple",formControl:"input, select, option, textarea",item:".mv-item",ui:".mv-ui",container:{tr:"table",option:"select"}},i=e.arr=function(t){return t.split(/\s*,\s*/g)},r=e.not=function(t){return i(t).map(function(t){return":not("+t+")"}).join("")},s=e.or=function(t,e){return t+", "+e},o=e.and=function(t,e){var n=[],r=i(e);return i(t).forEach(function(t){return n.push.apply(n,_toConsumableArray(r.map(function(e){return t+e})))}),n.join(", ")},a=e.andNot=function(t,e){return o(t,r(e))};t.extend(n.selectors,{primitive:a(e.property,e.group),rootGroup:a(e.group,e.property),output:s(e.specificProperty("output"),".mv-output, .mv-value")})}(),Promise.all([t.ready(),t.include(Array.from&&window.Intl&&document.documentElement.closest,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")])["catch"](function(t){return console.error(t);
}).then(function(){return Mavo.init()}),Stretchy.selectors.filter=".mv-editor:not([property])"}(Bliss,Bliss.$);
"use strict";!function(t,e){function n(t,n){for(t="mv-"+t+"-within",e("."+t).forEach(function(e){return e.classList.remove(t)});n&&n.classList;)n.classList.add(t),n=n.parentNode}var r=t.extend(Mavo,{toJSON:function(t){return null===t?"":"string"==typeof t?t:JSON.stringify(t,null,"\t")},readable:function(t){return t&&t.replace(/([a-z])([A-Z])(?=[a-z])/g,function(t,e,n){return e+" "+n.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(t){return t.toUpperCase()})},queryJSON:function(e,n){return n&&e?t.value.apply(t,[e].concat(n.split("/"))):e},toArray:function(t){return void 0===t?[]:Array.isArray(t)?t:[t]},"delete":function(t,e){var n=t&&t.indexOf(e);n>-1&&t.splice(n,1)},hasIntersection:function(t,e){return!t.every(function(t){return e.indexOf(t)==-1})},flatten:function(t){return Array.isArray(t)?t.reduce(function(t,e){return r.toArray(t).concat(r.flatten(e))},[]):[t]},is:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];
var o=!0,a=!1,u=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;if(l&&l.matches&&l.matches(r.selectors[t]))return!0}}catch(f){a=!0,u=f}finally{try{!o&&c["return"]&&c["return"]()}finally{if(a)throw u}}return!1},data:function(e,n,r){return void 0===r?t.value(e,"_","data","mavo",n):(e._.data.mavo=e._.mavo||{},void(e._.data.mavo[n]=r))},inViewport:function(t){var e=t.getBoundingClientRect();return(0<=e.bottom&&e.bottom<=innerHeight||0<=e.top&&e.top<=innerHeight)&&(0<=e.right&&e.right<=innerWidth||0<=e.left&&e.left<=innerWidth)},pushUnique:function(t,e){t.indexOf(e)===-1&&t.push(e)},getAttribute:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i,o=0;i=n[o];o++){var a=t.getAttribute(i);if(a)return a}return null},debounce:function(t,e){var n,r=null;return function(){var i=this,o=arguments;n=function(){t.apply(i,o),removeEventListener("beforeunload",n)},clearTimeout(r),r=setTimeout(n,e),addEventListener("beforeunload",n);
}},escapeRegExp:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Observer:t.Class({constructor:function(e,n,r,i){r instanceof MutationObserver&&(this.observer=r),this.observer=this.observer||new MutationObserver(r),this.element=e,this.callback=r,this.attribute=n,this.oldValue=i,this.options={},n&&t.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:[this.attribute],attributeOldValue:!!this.oldValue}),this.attribute&&"all"!=this.attribute||t.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!this.oldValue}),this.run()},stop:function(){return this.running&&(this.observer.disconnect(),this.running=!1),this},run:function(){return this.running||(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(t){var e=this;if(this.running){this.stop();var n=t();requestAnimationFrame(function(){return e.run()})}else var n=t();return n}}),defer:function(t){var e,n,r=new Promise(function(r,i){t&&t(r,i),
e=r,n=i});return r.resolve=function(t){return e(t),r},r.reject=function(t){return n(t),r},r},rr:function(t){return t(),t}});t.add("toggleAttribute",function(t,e){var n=arguments.length<=2||void 0===arguments[2]?null!==e:arguments[2];n?this.setAttribute(t,e):this.removeAttribute(t)}),t.proxy=t.classProps.proxy=t.overload(function(t,e,n){return Object.defineProperty(t,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t},configurable:!0,enumerable:!0}),t}),t.classProps.propagated=function(t,e){Mavo.toArray(e).forEach(function(e){var n=t[e];t[e]=function(){var t=n&&n.apply(this,arguments);this.propagate&&t!==!1&&this.propagate(e)}})},document.addEventListener("focus",function(t){n("focus",t.target)},!0),document.addEventListener("blur",function(t){n("focus",null)},!0),addEventListener("hashchange",function(e){n("target",t(location.hash))}),document.documentElement.addEventListener("mavo:datachange",function(e){n("target",t(location.hash))}),n("focus",document.activeElement!==document.body?document.activeElement:null);
}(Bliss,Bliss.$);
"use strict";!function(t){var i=Mavo.Permissions=t.Class({constructor:function(i){this.triggers=[],this.set(i),this.hooks=new t.Hooks},set:function(t){for(var i in t)this[i]=t[i]},on:function(t){var i=this;return Mavo.toArray(t).forEach(function(t){return i[t]=!0}),this},off:function(t){var i=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return i[t]=!1}),this},can:function(t,i,n){this.observe(t,!0,i),n&&this.cannot(t,n)},cannot:function(t,i){this.observe(t,!1,i)},when:function(t){var i=this;return new Promise(function(n,r){i.can(t,n,r)})},observe:function(t,i,n){t=Mavo.toArray(t),this.is(t,i)&&n(),this.triggers.push({actions:t,value:i,callback:n,active:!0})},is:function(t,i){var n=this,r=t.map(function(t){return!!n[t]}).reduce(function(t,i){return t||i});return i?r:!r},onchange:function(t){this.hooks.add("change",t);var n=!0,r=!1,o=void 0;try{for(var s,e=i.actions[Symbol.iterator]();!(n=(s=e.next()).done);n=!0){var a=s.value;t.call(this,{action:a,value:this[a],permissions:this
})}}catch(c){r=!0,o=c}finally{try{!n&&e["return"]&&e["return"]()}finally{if(r)throw o}}},changed:function(t,i,n){var r=this;n=!!n,i=!!i,i!=n&&(this["_"+t]=i,this.triggers.forEach(function(i){var n=r.is(i.actions,i.value);i.active&&i.actions.indexOf(t)>-1&&n?(i.active=!1,i.callback()):n||(i.active=!0)}),this.hooks.run("change",{action:t,value:i,permissions:this}))},or:function(t){var n=!0,r=!1,o=void 0;try{for(var s,e=i.actions[Symbol.iterator]();!(n=(s=e.next()).done);n=!0){var a=s.value;this[a]=this[a]||t[a]}}catch(c){r=!0,o=c}finally{try{!n&&e["return"]&&e["return"]()}finally{if(r)throw o}}return this},"static":{actions:[],register:function(n,r){return Array.isArray(n)?void n.forEach(function(t){return i.register(t,r)}):(t.live(i.prototype,n,function(t,i){r&&r.call(this,t,i),this.changed(n,t,i)}),void i.actions.push(n))}}});i.register(["read","save"]),i.register("login",function(t){t&&this.logout&&(this.logout=!1)}),i.register("logout",function(t){t&&this.login&&(this.login=!1)}),i.register("edit",function(t){
t&&(this.add=this["delete"]=!0)}),i.register(["add","delete"],function(t){t||(this.edit=!1)})}(Bliss);
"use strict";!function(t){var e=Mavo.Backend=t.Class({constructor:function(t,e){this.url=t,this.mavo=e,this.permissions=new Mavo.Permissions},get:function(){return t.fetch(this.url.href,{responseType:"json"}).then(function(t){return Promise.resolve(t.response)},function(){return Promise.resolve(null)})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},getFile:function(){var t=this.mavo.getData({unhandled:!0});return{data:t,dataString:Mavo.toJSON(t),path:this.path||""}},toString:function(){return this.id+" ("+this.url+")"},"static":{create:function(t,n){if(t.indexOf||console.log(t),t){var r=e.types.filter(function(e){return e.test(t)})[0]||e.Remote;return new r(t,n)}return null},types:[],register:function(t){return e[t.prototype.id]=t,e.types.push(t),t}}});e.register(t.Class({id:"Element","extends":e,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=t(this.url)||t.create("script",{type:"application/json",
id:this.url.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(){var t=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];return this.element.textContent=t.dataString,Promise.resolve(t)},"static":{test:function(t){return 0===t.indexOf("#")}}})),e.register(t.Class({id:"Remote","extends":e,constructor:function(){this.permissions.on("read"),this.url=new URL(this.url,location)},"static":{test:function(t){return!1}}})),e.register(t.Class({"extends":e,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(){var t=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];return null===t.data?delete localStorage[this.key]:localStorage[this.key]=t.dataString,Promise.resolve(t)},"static":{test:function(t){return"local"==t}}}))}(Bliss);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}!function(t,e){var o=Mavo.Node=t.Class({"abstract":!0,constructor:function(t,e){var r=this,n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!t||!e)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var i={context:this,options:n};this.uid=++o.maxId,o.all.set(t,[].concat(_toConsumableArray(o.all.get(this.element)||[]),[this])),this.element=t,this.template=i.options.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=e,this.fromTemplate("property","type","modes")||(this.property=o.getProperty(t),this.type=Mavo.Group.normalize(t),this.store=this.element.getAttribute("mv-storage"),this.modes=this.element.getAttribute("mv-mode")),this.modeObserver=new Mavo.Observer(this.element,"mv-mode",function(t){console.log("%cmutation observer on","color:purple;",r.property,r.uid,r.template),
r.mode=r.element.getAttribute("mv-mode"),r["edit"==r.mode?"edit":"done"]()}),this.mode=this.modes||"read",this.group=this.parentGroup=i.options.group,Mavo.hooks.run("node-init-end",i)},get editing(){return"edit"==this.mode},get constant(){return"read"==this.modes},get isRoot(){return!this.property},get name(){return Mavo.readable(this.property||this.type).toLowerCase()},get data(){return this.getData()},get saved(){return"none"!==this.store},get path(){var t=this.parentGroup?this.parentGroup.path:[];return this.property?[].concat(_toConsumableArray(t),[this.property]):t},getData:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.isDataNull(t)?null:void this.walkUp(function(e){if(e.isDataNull(t))return null})},isDataNull:function(t){var e={context:this,options:t,result:this.deleted||!this.saved&&"*"!=t.store};return Mavo.hooks.run("unit-isdatanull",e),e.result},walk:function(t){var e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=function r(e,o){
var n=t(e,o);if(n!==!1)for(var i in e.children){var a=e.children[i];if(a instanceof Mavo.Node){var n=r.call(a,a,[].concat(_toConsumableArray(o),[i]));if(n===!1)return!1}}return n!==!1};return o(this,e)},walkUp:function(t){for(var e=this;e=e.parentGroup;){var o=t(e);if(void 0!==o)return o}},edit:function(){this.mode="edit",this.propagate("edit"),Mavo.hooks.run("node-edit-end",this)},done:function(){this.mode="read",t.unbind(this.element,".mavo:edit"),this.propagate("done"),Mavo.hooks.run("node-done-end",this)},propagate:function(t){for(var e in this.children){var o=this.children[e];o instanceof Mavo.Node&&("function"==typeof t?t.call(o,o):t in o&&o[t]())}},propagated:["save","revert"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];var r=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;this[u]=this.template[u]}}catch(h){n=!0,i=h}finally{try{!r&&s["return"]&&s["return"]();
}finally{if(n)throw i}}}return!!this.template},render:function(t){Mavo.hooks.run("node-render-start",this),this.rendering=!0,this.editing?(this.done(),this.dataRender(t),this.edit()):this.dataRender(t),this.save(),this.rendering=!1,Mavo.hooks.run("node-render-end",this)},dataChanged:function(e){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.rendering||t.fire(o.element||this.element,"mavo:datachange",t.extend({property:this.property,action:e,mavo:this.mavo,node:this},o))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},live:{store:function(e){t.toggleAttribute(this.element,"mv-storage",e)},unsavedChanges:function(t){return!t||this.saved&&this.editing||(t=!1),this.element.classList.toggle("mv-unsaved-changes",t),t},mode:function(e){var o=this;this._mode!=e&&(this._mode=e,this.modeObserver.sneak(function(){var r=o.modes||"edit"==o.mode;t.toggleAttribute(o.element,"mv-mode",e,r)}))}},"static":{maxId:0,all:new WeakMap,create:function(t,e){
var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return Mavo.is("multiple",t)&&!o.collection?new Mavo.Collection(t,e,o):new(Mavo[Mavo.is("group",t)?"Group":"Primitive"])(t,e,o)},getProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");return!e&&t.hasAttribute("property")&&(e=t.name||t.id||t.classList[0]),e&&t.setAttribute("property",e),e},get:function(t,e){var r=(o.all.get(t)||[]).filter(function(t){return!(t instanceof Mavo.Collection)});return r.length<2||!e?r[0]:r[0]instanceof Mavo.Group?node[1]:void 0}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}!function(t,e){var r=Mavo.Group=t.Class({"extends":Mavo.Node,nodeType:"Group",constructor:function(t,r,a){var i=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element)){this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this})}e(Mavo.selectors.property,this.element).forEach(function(t){var e=Mavo.Node.getProperty(t);if(i.contains(t)){var r=i.children[e],a=i.template?i.template.children[e]:null,n={template:a,group:i};if(r){var o=r;r instanceof Mavo.Collection||(o=new Mavo.Collection(r.element,i.mavo,n),i.children[e]=r.collection=o,o.add(r)),!o.mutable&&Mavo.is("multiple",t)&&(o.mutable=!0),o.add(t)}else{var s=Mavo.Node.create(t,i.mavo,n);i.children[e]=s}}});var n=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=n.getAttribute("vocab"),
Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getData:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a={context:this,options:e,data:this["super"].getData.call(this,e)};return void 0!==a.data?a.data:(a.data={},this.propagate(function(t){if((t.saved||"*"==e.store)&&!(t.property in a.data)){var r=t.getData(e);(null!==r||a.options["null"])&&(a.data[t.property]=r)}}),a.options.unhandled&&t.extend(a.data,this.unhandled),this.type&&this.type!=r.DEFAULT_TYPE&&(a.data["@type"]=this.type),this.vocab&&(a.data["@context"]=this.vocab),a.data.summary&&(a.data.toString=function(){return this.summary}),Mavo.hooks.run("node-getdata-end",a),a.data)},find:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.property==t)return this;if(t in this.children)return this.children[t].find(t,e);var r=[];for(var a in this.children){var i=this.children[a].find(t,e);if(void 0!==i){if(!Array.isArray(i))return i;r.push.apply(r,_toConsumableArray(i));
}}return r.length?r:void 0},save:function(){this.unsavedChanges=!1},propagated:["save","import","clear"],dataRender:function(e){var r=this;e&&(e=Array.isArray(e)?e[0]:e,this.unhandled=t.extend({},e,function(t){return!(t in r.children)}),this.propagate(function(t){t.render(e[t.property])}))},contains:function(t){return t instanceof Mavo.Node?t.parentGroup===this:t.parentNode&&this.element===t.parentNode.closest(Mavo.selectors.group)},"static":{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(t){if(Mavo.is("group",t)){var e=Mavo.getAttribute(t,"typeof","itemtype")||r.DEFAULT_TYPE;return t.setAttribute("typeof",e),e}return null}}})}(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e){var i=Mavo.Primitive=t.Class({"extends":Mavo.Node,nodeType:"Primitive",constructor:function(a,n,s){var o=this;if(this.fromTemplate("defaults","attribute","templateValue")||(this.defaults=i.getDefaults(a),this.attribute=i.getValueAttribute(this.element,this.defaults)),this.datatype=this.defaults.datatype,this.modes=this.modes||this.defaults.modes,this.mode=this.modes||"read",Mavo.hooks.run("primitive-init-start",this),this.defaults.init&&this.defaults.init.call(this,this.element),this.defaults.changeEvents&&t.events(this.element,this.defaults.changeEvents,function(t){t.target===o.element&&(o.value=o.getValue())}),this.editor||this.attribute||(this.editor=e(this.element.children).filter(function(t){return t.matches(Mavo.selectors.formControl)&&!t.matches(Mavo.selectors.property);
})[0],this.editor&&(this.element.textContent=this.editorValue,t.remove(this.editor))),!this.editor&&this.element.hasAttribute("mv-edit")){var r=t(this.element.getAttribute("mv-edit"));r&&Mavo.is("formControl",r)&&(this.editor=r.cloneNode(!0),this.template||new Mavo.Observer(r,"all",function(t){var e=!0,i=!1,a=void 0;try{for(var n,s=o.copies[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var u=n.value;u.editor=r.cloneNode(!0),u.setValue(u.value,{force:!0,silent:!0})}}catch(l){i=!0,a=l}finally{try{!e&&s["return"]&&s["return"]()}finally{if(i)throw a}}}))}this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this["default"]?this._default=this.constant?this.templateValue:this.editor?this.editorValue:void 0:""===this["default"]?this._default=this.templateValue:new Mavo.Observer(this.element,"mv-default",function(t){o["default"]=o.element.getAttribute("mv-default")}),this.initialValue=(this.template||void 0!==this["default"]?this["default"]:this.templateValue)||this.emptyValue,
this.setValue(this.initialValue,{silent:!0}),this.observer=new Mavo.Observer(this.element,this.attribute,function(t){!o.attribute&&o.editing||(o.value=o.getValue())}),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){if(this.defaults.getEditorValue)return this.defaults.getEditorValue.call(this);if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return i.getValue(this.editor,{datatype:this.datatype});var e=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(e)return i.getValue(e)}},set editorValue(e){if(this.defaults.setEditorValue)return this.defaults.setEditorValue.call(this,e);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))i.setValue(this.editor,e,{defaults:this.editorDefaults});else{var a=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);a&&i.setValue(a,e)}},getData:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e={context:this,options:t,data:this["super"].getData.call(this,t)
};return void 0!==e.data?e.data:(e.data=this.value,""===e.data&&(e.data=null),Mavo.hooks.run("node-getdata-end",e),e.data)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},done:function(){var e=this;this["super"].done.call(this),"preEdit"in this&&t.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return e.defaults.done?void e.defaults.done.call(e):void(e.popup?e.popup.close():!e.attribute&&e.editor&&(t.remove(e.editor),e.element.textContent=e.editorValue))}),null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex")},revert:function(){this.unsavedChanges&&void 0!==this.savedValue&&(this.value=this.savedValue,this.unsavedChanges=!1)},sneak:function(t){this.observer?this.observer.sneak(t):t()},initEdit:function(){var a=this;if(!this.editor){var n=this.defaults.editor||Mavo.Elements["*"].editor;this.editor=t.create("function"===t.type(n)?n.call(this):n),this.editorValue=this.value;
}t.events(this.editor,{"input change":function(t){a.value=a.editorValue},focus:function(t){a.editor.select&&a.editor.select()},"mavo:datachange":function(e){"output"===e.property&&(e.stopPropagation(),t.fire(a.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var s=/^mv-edit-/i;e(this.element.attributes).forEach(function(t){s.test(t.name)&&this.editor.setAttribute(t.name.replace(s,""),t.value)},this),this.attribute&&(this.popup=new i.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var e=this;if(!this.constant)return this["super"].edit.call(this),this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0,this.element.addEventListener("click.mavo:edit",function(t){return t.preventDefault()}),this.preEdit=Mavo.defer(function(i,a){if(e.empty&&!e.attribute)return i();var n;t.events(e.element,{"click.mavo:preedit":i,"focus.mavo:preedit":i}),e.attribute||t.events(e.element,{
"mouseenter.mavo:preedit":function(t){clearTimeout(n),n=setTimeout(i,150)},"mouseleave.mavo:preedit":function(t){clearTimeout(n)}})}),this.defaults.edit?void this.defaults.edit.call(this):void this.preEdit.then(function(){t.unbind(e.element,".mavo:preedit"),e.initEdit&&e.initEdit(),e.popup?e.popup.show():e.editor.focus(),e.attribute||e.editor.parentNode!=e.element&&(e.editorValue=e.value,e.element.textContent="",e.element.appendChild(e.editor))})},clear:function(){this.constant||(this.value=this.emptyValue)},dataRender:function(t){Array.isArray(t)&&(t=t[0]),"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(t=t[this.property]),void 0===t?this.value=this.closestCollection?this["default"]:this.templateValue:this.value=t},find:function(t){if(this.property==t)return this},getValue:function(t){return i.getValue(this.element,{defaults:this.defaults,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.readable(this.property)},emptyValue:function(){switch(this.datatype){
case"boolean":return!1;case"number":return 0}return""},editorDefaults:function(){return this.editor&&i.getDefaults(this.editor)}},setValue:function(e){var a=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.sneak(function(){if("object"==t.type(e)&&"value"in e){var s=e.presentational;e=e.value}return e=e||0===e?e:"",e=i.safeCast(e,a.datatype),e!=a._value||n.force?(a.editor&&document.activeElement!=a.editor&&(a.editorValue=e),a.defaults.humanReadable&&a.attribute&&(s=a.defaults.humanReadable.call(a,e)),a.editing&&!a.attribute&&a.editor||(a.defaults.setValue?a.defaults.setValue.call(a,a.element,e):(a.editor&&a.editor.matches("select")&&a.editor.selectedOptions[0]&&(s=a.editor.selectedOptions[0].textContent),n.dataOnly||i.setValue(a.element,{value:e,presentational:s},{defaults:a.defaults,attribute:a.attribute,datatype:a.datatype}))),a.empty=""===e,a._value=e,void(n.silent||(a.saved&&(a.unsavedChanges=a.mavo.unsavedChanges=!0),a.dataChanged("propertychange",{value:e
})))):e}),e},dataChanged:function(){var t=arguments.length<=0||void 0===arguments[0]?"propertychange":arguments[0],e=arguments[1];return this["super"].dataChanged.call(this,t,e)},live:{"default":function(t){this.value==this._default&&(this.value=t)},value:function(t){return this.setValue(t)},empty:function(e){var i=e&&!this.constant&&!(this.attribute&&t(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",i)}},"static":{all:new WeakMap,getDefaults:function(t){var e=null;for(var i in Mavo.Elements)t.matches(i)&&(e=Mavo.Elements[i]);return e},getValueAttribute:function(t){var e=arguments.length<=1||void 0===arguments[1]?i.getDefaults(t):arguments[1],a=t.getAttribute("mv-attribute")||e.attribute;return a&&"null"!==a||(a=null),a},safeCast:function(t,e){var a=("undefined"==typeof t?"undefined":_typeof(t),i.cast(t,e));return null===t||void 0===t?t:"boolean"==e?"false"!==t&&0!==t&&""!==t&&("true"===t||t>0||t):"number"==e?/^[-+]?[0-9.e]+$/i.test(t+"")?a:t:a},cast:function(t,e){
switch(e){case"number":return+t;case"boolean":return!!t;case"string":return t+""}return t},getValue:function(t,e){var a=e.defaults,n=void 0===a?i.getDefaults(t):a,s=e.attribute,o=void 0===s?i.getValueAttribute(t,n):s,r=e.datatype,u=void 0===r?n.datatype:r;if(n.getValue&&o==n.attribute)return n.getValue(t);var l;return l=o in t&&i.useProperty(t,o)?t[o]:o?t.getAttribute(o):t.getAttribute("content")||t.textContent||null,i.safeCast(l,u)},setValue:function(e,a,n){var s=n.defaults,o=n.attribute,r=n.datatype;if("object"==t.type(a)&&"value"in a){var u=a.presentational;a=a.value}if(1===e.nodeType&&(s=s||i.getDefaults(e),o=void 0!==o?o:i.getValueAttribute(e,s),r=void 0!==r?r:s.datatype,s.setValue&&o==s.attribute))return s.setValue(e,a);if(o){if(o in e&&i.useProperty(e,o)&&e[o]!==a)try{e[o]=a}catch(l){}"boolean"==r?a!=e.hasAttribute(o)&&t.toggleAttribute(e,o,a,a):e.getAttribute(o)!=a&&(e.setAttribute(o,a),u&&(e.textContent=u))}else"number"!==r||u||(u=i.formatNumber(a)),e.textContent=u||a,u&&e.setAttribute&&e.setAttribute("content",a);
},useProperty:function(t,e){return!(["href","src"].indexOf(e)>-1)&&"http://www.w3.org/2000/svg"!=t.namespaceURI},lazy:{formatNumber:function(){var t=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(e){return e===1/0||e===-(1/0)?e<0?"-∞":"∞":t.format(e)}}}}});i.Popup=t.Class({constructor:function(e){var i=this;this.primitive=e,this.popup=t.create("div",{className:"mv-popup",hidden:!0,contents:[this.primitive.label+":",this.editor],events:{keyup:function(t){13!=t.keyCode&&27!=t.keyCode||(i.popup.contains(document.activeElement)&&i.element.focus(),t.stopPropagation(),i.hide())}}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var e=this;t.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(t){e.popup.contains(t.target)||e.element.contains(t.target)||e.hide()},this.position=function(i){var a=e.element.getBoundingClientRect(),n=a.left,s=a.bottom;t.style(e.popup,{top:s+"px",
left:n+"px"})},this.position(),document.body.appendChild(this.popup),requestAnimationFrame(function(t){return e.popup.removeAttribute("hidden")}),t.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var e=this;t.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){t.remove(e.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),t.events(this.element,{"click.mavo:showpopup":function(t){e.show()},"keyup.mavo:showpopup":function(t){[13,113].indexOf(t.keyCode)>-1&&(e.show(),e.editor.focus())}})},close:function(){this.hide(),t.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})}(Bliss,Bliss.$);
"use strict";!function(e,t){Mavo.Elements={"*":{editor:{tag:"input"}},"img, video, audio":{attribute:"src",editor:{tag:"input",type:"url",placeholder:"http://"}},"a, link":{attribute:"href"},"select, input":{attribute:"value",modes:"read",changeEvents:"input change"},textarea:{modes:"read",changeEvents:"input",getValue:function(e){return e.value},setValue:function(e,t){return e.value=t}},"input[type=range], input[type=number]":{attribute:"value",datatype:"number",modes:"read",changeEvents:"input change"},"button, .counter":{attribute:"mv-clicked",datatype:"number",modes:"read",init:function(e){var t=this;"mv-clicked"===this.attribute&&(e.setAttribute("mv-clicked","0"),e.addEventListener("click",function(i){var n=+e.getAttribute("mv-clicked")||0;t.value=++n}))}},"input[type=checkbox]":{attribute:"checked",datatype:"boolean",modes:"read",changeEvents:"click"},"meter, progress":{attribute:"value",datatype:"number",edit:function(){var e=this,t=+this.element.getAttribute("min")||0,i=+this.element.getAttribute("max")||1,n=i-t,a=+this.element.getAttribute("mv-edit-step")||(n>1?1:n/100);
this.element.addEventListener("mousemove.mavo:edit",function(r){var u=e.element.getBoundingClientRect().left,d=Math.max(0,(r.clientX-u)/e.element.offsetWidth),o=t+n*d,m=o%a;o+=m>a/2?a-m:-m,o=Math.max(t,Math.min(o,i)),e.sneak(function(){return e.element.setAttribute("value",o)})}),this.element.addEventListener("mouseleave.mavo:edit",function(t){e.sneak(function(){return e.element.setAttribute("value",e.value)})}),this.element.addEventListener("click.mavo:edit",function(t){e.value=e.getValue()}),this.element.addEventListener("keydown.mavo:edit",function(n){if(n.target==e.element&&(37==n.keyCode||39==n.keyCode)){var r=a*(39==n.keyCode?1:-1)*(n.shiftKey?10:1),u=e.value+r;u=Math.max(t,Math.min(u,i)),e.element.setAttribute("value",u)}})},done:function(){e.unbind(this.element,".mavo:edit")}},meta:{attribute:"content"},"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address":{editor:function i(){var t=getComputedStyle(this.element).display,n=0===t.indexOf("inline")?"input":"textarea",i=e.create(n);
if("textarea"==n){var a=this.element.offsetWidth;a&&(i.width=a)}return i},setEditorValue:function(e){if(!this.datatype||"string"==this.datatype){var t=getComputedStyle(this.element);return e=e||"",["normal","nowrap"].indexOf(t.whiteSpace)>-1&&(e=e.replace(/\r?\n/g," ")),["normal","nowrap","pre-line"].indexOf(t.whiteSpace)>-1&&(e=e.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=e,!0}}},time:{attribute:"datetime",editor:function(){var e={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},t=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var i in e)if(e[i].test(t))break;return{tag:"input",type:i}},humanReadable:function(e){var t=new Date(e);if(!e||isNaN(t))return"(No "+this.label+")";var i={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",
month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},n=i[this.editor&&this.editor.type]||i.date;return n.timeZone="UTC",t.toLocaleString("en-GB",n)}}}}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(e,t){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var n=Mavo.Collection=e.Class({"extends":Mavo.Node,nodeType:"Collection",constructor:function(e,n,i){if(this.templateElement=this.element,this.children=[],this.fromTemplate("properties","mutable","templateElement","accepts")||(this.properties=t(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0)),this.mutable){var o=this.createItem(this.element);this.add(o),this.itemTemplate=o.template||o}Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t={
context:this,options:e,data:[]},n=!0,i=!1,o=void 0;try{for(var a,r=this.children[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)if(item=a.value,!item.deleted){var l=item.getData(t.options);l&&t.data.push(l)}}catch(s){i=!0,o=s}finally{try{!n&&r["return"]&&r["return"]()}finally{if(i)throw o}}return this.unhandled&&t.options.unhandled&&(t.data=this.unhandled.before.concat(t.data,this.unhandled.after)),this.mutable||1!=t.data.length||(t.data=t.data[0]),Mavo.hooks.run("node-getdata-end",t),t.data},createItem:function(e){e||(e=this.templateElement.cloneNode(!0));var t=Mavo.Node.create(e,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return t},add:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e=e instanceof Node?Mavo.Node.get(e)||this.createItem(e):e||this.createItem(),e.collection!=this&&this.adopt(e),void 0===t&&(t=this.bottomUp?0:this.length),this.mutable){var i=this.children[t];
e.element._.before(i&&i.element||this.marker)}var o={context:this,item:e};return o.previousIndex=e.index,o.changed=this.splice({remove:o.item},{index:t,add:o.item}),n.silent||(o.changed.forEach(function(e){e.dataChanged(e==o.item&&void 0===o.previousIndex?"add":"move"),e.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0),Mavo.hooks.run("collection-add-end",o),o.item},splice:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=!0,o=!1,a=void 0;try{for(var r,l=t[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var s=r.value;void 0===s.index&&s.remove&&isNaN(s.remove)&&(s.index=this.children.indexOf(s.remove),s.remove=1)}}catch(d){o=!0,a=d}finally{try{!i&&l["return"]&&l["return"]()}finally{if(o)throw a}}t.sort(function(e,t){return t.index-e.index});var c=!0,h=!1,m=void 0;try{for(var u,v=t[Symbol.iterator]();!(c=(u=v.next()).done);c=!0){var p=u.value;if(p.index>-1&&(p.remove||p.add)){var f;p.remove=p.remove||0,p.add=Mavo.toArray(p.add),(f=this.children).splice.apply(f,[p.index,+p.remove].concat(_toConsumableArray(p.add)));
}}}catch(d){h=!0,m=d}finally{try{!c&&v["return"]&&v["return"]()}finally{if(h)throw m}}for(var g=[],y=0;y<this.length;y++){var C=this.children[y];C&&C.index!==y&&(C.index=y,g.push(C))}return g},adopt:function(e){var t=this;e.collection&&(e.collection.splice({remove:e}),e.collection.dataChanged("delete")),this.walk(function(n){n.closestCollection===e.collection&&(n.closestCollection=t),e.mavo!=t.mavo&&(e.mavo=t.mavo)}),e.collection=this,e.template&&(Mavo["delete"](e.template.copies,e),e.template=this.itemTemplate)},"delete":function(t,n){var i=this;return n?(e.remove(t.element),void this.splice({remove:t})):e.transition(t.element,{opacity:0}).then(function(){t.deleted=!0,t.element.style.opacity="",t.dataChanged("delete"),i.unsavedChanges=t.unsavedChanges=i.mavo.unsavedChanges=!0})},edit:function(){var t=this;if(this["super"].edit.call(this),this.mutable){if(!this.addButton.parentNode)if(this.bottomUp)this.addButton._.before(e.value(this.children[0],"element")||this.marker);else{var i=this.element.tagName.toLowerCase(),o=Mavo.selectors.container[i];
if(o)var a=this.marker.parentNode.closest(o);this.addButton._.after(a&&a.parentNode?a:this.marker)}n.dragula.then(function(){t.getDragula()})}},done:function(){this["super"].done.call(this),this.mutable&&this.addButton.parentNode&&this.addButton.remove()},clear:function(){this.mutable&&(this.propagate(function(e){if(e.element.remove)e.element.remove();else{var t=!0,n=!1,i=void 0;try{for(var o,a=e.element.childNodes[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value}}catch(r){n=!0,i=r}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw i}}}}),this.children=[],this.dataChanged("clear"))},dataChanged:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t.element=t.element||this.marker,this["super"].dataChanged.call(this,e,t)},save:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this.children[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.deleted?this["delete"](a,!0):a.unsavedChanges=!1}}catch(r){t=!0,n=r}finally{try{!e&&o["return"]&&o["return"]();
}finally{if(t)throw n}}},propagated:["save"],revert:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=this.children[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.unsavedChanges?this["delete"](a,!0):(a.deleted&&(a.deleted=!1),a.revert())}}catch(r){t=!0,n=r}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}},dataRender:function(e){var t=this;if(this.unhandled={before:[],after:[]},e)if(e=Mavo.toArray(e),this.mutable){this.clear();var n=document.createDocumentFragment();e.forEach(function(e,i){var o=t.createItem();o.render(e),t.children.push(o),o.index=i,n.appendChild(o.element);var a={context:t,item:o};Mavo.hooks.run("collection-add-end",a)}),this.marker.parentNode.insertBefore(n,this.marker)}else this.children.forEach(function(t,n){return t.render(e&&e[n])}),e&&(this.unhandled.after=e.slice(this.length))},find:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this.children.filter(function(e){return!e.deleted});if(this.property==e)return t.collections?this:n;
if(this.properties.indexOf(e)>-1){var i=n.map(function(n){return n.find(e,t)});return Mavo.flatten(i)}},isCompatible:function(e){return e&&this.itemTemplate.nodeType==e.itemTemplate.nodeType&&(e===this||e.template==this||this.template==e||this.template&&this.template==e.template||this.accepts.indexOf(e.property)>-1)},live:{mutable:function(t){t&&t!==this.mutable&&(this._mutable=t,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),e.after(this.marker,this.templateElement),this.templateElement.classList.add("mv-item"))}},getDragula:function(){var e=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(t){return!!e.accepts.length&&Mavo.flatten(e.accepts.map(function(t){return e.mavo.root.find(t,{collections:!0})})).filter(function(e){
return e&&e instanceof n}).map(function(e){return e.marker.parentNode}).indexOf(t)>-1},moves:function(e,t,n){return n.classList.contains("mv-drag-handle")&&n.closest(Mavo.selectors.item)==e},accepts:function(e,t,i,o){if(e.contains(t))return!1;var a=o?o.previousElementSibling:t.lastElementChild,r=n.get(a)||n.get(o);if(!r)return!1;var l=Mavo.Node.get(e);return l&&l.collection.isCompatible(r)}}),this.dragula.on("drop",function(t,i,o){var a=Mavo.Node.get(t),r=(a&&a.index,t.nextElementSibling),l=t.previousElementSibling,s=n.get(l)||n.get(r),d=Mavo.Node.get(l)||Mavo.Node.get(r);if(d&&d.collection!=s&&(d=null),!a.collection.isCompatible(s))return e.dragula.cancel(!0);var c=d?d.index+(d.element===l):s.length;s.add(a,c)}),n.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var e=this.templateElement.getAttribute("mv-order");return null!==e?/^desc\b/i.test(e):!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.templateElement)&Node.DOCUMENT_POSITION_FOLLOWING);
},closestCollection:function(){var e=this.marker?this.marker.parentNode:this.templateElement.parentNode;return e.closest(Mavo.selectors.item)},addButton:function(){var n=this,i="button.mv-add-"+this.property,o=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(o)var a=t(i,o).filter(function(e){return!n.templateElement.contains(e)})[0];return a||(a=e.create("button",{className:"mv-add",textContent:"Add "+this.name})),a.classList.add("mv-ui","mv-add"),Mavo.data(a,"collection",this),this.property&&a.classList.add("mv-add-"+this.property),a.addEventListener("click",function(e){e.preventDefault(),n.add().edit()}),a}},"static":{dragulas:[],get:function(e){var t=Mavo.data(e,"collection");if(t)return t;var n=Mavo.Node.get(e);return n&&n.collection||null},lazy:{dragula:function(){return e.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}});Mavo.hooks.add("primitive-init-end",function(){var t=this;if(this.collection&&!this.attribute){
var n=function(n){var i;return t.sneak(function(){var o=e.remove(e(".mv-item-controls",t.element));i=n(),e.inside(o,t.element)}),i};["textContent","innerHTML"].forEach(function(e){var i=Object.getOwnPropertyDescriptor(Node.prototype,e);Object.defineProperty(t.element,e,{get:function(){var e=this;return n(function(){return i.get.call(e)})},set:function(e){var t=this;n(function(){return i.set.call(t,e)})}})})}}),Mavo.hooks.add("node-edit-end",function(){var n=this;this.collection&&(this.itemControls||(this.itemControls=t(".mv-item-controls",this.element).filter(function(e){return e.closest(Mavo.selectors.item)==n.element})[0],this.itemControls=this.itemControls||e.create({className:"mv-item-controls mv-ui"}),e.set(this.itemControls,{contents:[{tag:"button",title:"Delete this "+this.name,className:"mv-delete",events:{click:function(e){return n.collection["delete"](n)}}},{tag:"button",title:"Add new "+this.name.replace(/s$/i,"")+" "+(this.collection.bottomUp?"after":"before"),className:"mv-add",
events:{click:function(e){var t=n.collection.add(null,n.index+n.collection.bottomUp);return e[Mavo.superKey]&&t.render(n.data),Mavo.inViewport(t.element)||t.element.scrollIntoView({behavior:"smooth"}),t.edit()}}},{tag:"button",title:"Drag to reorder "+this.name,className:"mv-drag-handle"}]})),this.itemControls.parentNode||this.element.appendChild(this.itemControls))}),Mavo.hooks.add("node-done-end",function(){this.collection&&this.itemControls&&this.itemControls.remove()}),Mavo.Node.prototype.getClosestCollection=function(){return this.collection||this.group.collection||(this.parentGroup?this.parentGroup.closestCollection:null)},e.lazy(Mavo.Node.prototype,"closestCollection",function(){return this.getClosestCollection()}),e.live(Mavo.Node.prototype,"deleted",function(n){var i=this;this.element.classList.toggle("mv-deleted",n),n?(this.elementContents=document.createDocumentFragment(),t(this.element.childNodes).forEach(function(e){i.elementContents.appendChild(e)}),e.contents(this.element,[{
tag:"button",className:"mv-close mv-ui",textContent:"×",events:{click:function(t){e.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(e){return i.deleted=!1}}}]),this.element.classList.remove("mv-highlight")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"))}),Mavo.Node.prototype.isDeleted=function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},Mavo.hooks.add("node-init-end",function(e){this.collection=e.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup)})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(e){Mavo.attributes.push("mv-expressions");var t=Mavo.Expression=e.Class({constructor:function(e){this.expression=e},eval:function(e){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this["function"]||(this["function"]=t.compile(this.expression),this.identifiers=this.expression.match(/[$a-z][$\w]*/gi)||[]),this.value=this["function"](e)}catch(r){console.log(r),Mavo.hooks.run("expression-eval-error",{context:this,exception:r}),this.value=r}return this.value},toString:function(){return this.expression},changedBy:function(e){if(!this.identifiers||!e)return!0;if(this.identifiers.indexOf(e.property)>-1)return!0;if("propertychange"!=e.action){if(Mavo.hasIntersection(["$index","$all","$previous","$next"],this.identifiers))return!0;var t=e.node.collection||e.node;if(Mavo.hasIntersection(t.properties,this.identifiers))return!0;
}return!!Mavo.hasIntersection(Mavo.allIds,this.identifiers)},live:{expression:function(e){e=e;this["function"]=null}},"static":{serializers:{BinaryExpression:function(e){return t.serialize(e.left)+" "+e.operator+" "+t.serialize(e.right)},UnaryExpression:function(e){return""+e.operator+t.serialize(e.argument)},CallExpression:function(e){return t.serialize(e.callee)+"("+e.arguments.map(t.serialize).join(", ")+")"},ConditionalExpression:function(e){return t.serialize(e.test)+"? "+t.serialize(e.consequent)+" : "+t.serialize(e.alternate)},MemberExpression:function(e){return"get("+t.serialize(e.object)+', "'+(e.property.name||e.property.value)+'")'},ArrayExpression:function(e){return"["+e.elements.map(t.serialize).join(", ")+"]"},Literal:function(e){return e.raw},Identifier:function(e){return e.name},ThisExpression:function(e){return"this"},Compound:function(e){return e.body.map(t.serialize).join(" ")}},transformations:{BinaryExpression:function(e){var r=Mavo.Script.getOperatorName(e.operator),i=(Mavo.Script.operators[r],
e),n=[];do n.unshift(i.right),i=i.left;while(Mavo.Script.getOperatorName(i.operator)===r);if(n.unshift(i),n.length>1)return r+"("+n.map(t.serialize).join(", ")+")"},CallExpression:function(e){"Identifier"==e.callee.type&&"if"==e.callee.name&&(e.callee.name="iff")}},serialize:function(e){if(t.transformations[e.type]){var r=t.transformations[e.type](e);if(void 0!==r)return r}return t.serializers[e.type](e)},rewrite:function(e){try{return t.serialize(t.parse(e))}catch(r){return e}},compile:function(e){return e=t.rewrite(e),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\t\twith(data) {\n\t\t\t\t\t\treturn "+e+";\n\t\t\t\t\t}")},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.addBinaryOp("mod",10),jsep.removeBinaryOp("===")),t.serializers.LogicalExpression=t.serializers.BinaryExpression,t.transformations.LogicalExpression=t.transformations.BinaryExpression,t.Syntax=e.Class({constructor:function(e,t){this.start=e,this.end=t,
this.regex=RegExp(Mavo.escapeRegExp(e)+"([\\S\\s]+?)"+Mavo.escapeRegExp(t),"gi")},test:function(e){return this.regex.lastIndex=0,this.regex.test(e)},tokenize:function(e){var t,r=[],i=0;for(this.regex.lastIndex=0;null!==(t=this.regex.exec(e));)t.index>i&&r.push(e.substring(i,t.index)),i=this.regex.lastIndex,r.push(new Mavo.Expression(t[1]));return i<e.length&&r.push(e.substring(i)),r},"static":{create:function(e){if(e){var r=e.getAttribute("mv-expressions");if(r)return r=r.trim(),/\s/.test(r)?new(Function.prototype.bind.apply(t.Syntax,[null].concat(_toConsumableArray(r.split(/\s+/))))):t.Syntax.ESCAPE}},ESCAPE:-1}}),t.Syntax["default"]=new t.Syntax("[","]")}(Bliss);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(t){var e=Mavo.ExpressionText=t.Class({constructor:function(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.mavo=i.mavo,this.template=i.template&&i.template.template||i.template;for(var s=["item","path","syntax","fallback","attribute"],n=0;n<s.length;n++){var a=s[n];this[a]=void 0===i[a]&&this.template?this.template[a]:i[a]}if(this.node=i.node,this.node||(this.node=this.path.reduce(function(t,e){return t.childNodes[e]},this.item.element)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("expressiontext-init-start",this),!this.expression){if(3===this.node.nodeType&&(this.element=this.node.parentNode,this.node.parentNode.children.length&&!this.attribute||(this.node=this.element,this.element.normalize())),this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{
if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var r=this.node.firstChild.textContent.match(/^\s*|\s*$/g);r[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-r[1].length),t.after(this.node.lastChild,this.node)),r[0]&&(this.node.firstChild.splitText(r[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=i.template?i.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(t){return t instanceof Mavo.Expression?t.expression:t}),Mavo.hooks.run("expressiontext-init-end",this),e.elements.set(this.element,[].concat(_toConsumableArray(e.elements.get(this.element)||[]),[this]))},changedBy:function(t){return!this.parsed.every(function(e){return!(e instanceof Mavo.Expression&&e.changedBy(t))})},update:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0],i=arguments[1];
this.data=e;var s={};Mavo.hooks.run("expressiontext-update-start",this),this.oldValue=this.value,s.value=this.value=this.parsed.map(function(s,n){if(s instanceof Mavo.Expression){if(s.changedBy(i)){var a={context:t,expr:s};return Mavo.hooks.run("expressiontext-update-beforeeval",a),a.value=a.expr.eval(e),Mavo.hooks.run("expressiontext-update-aftereval",a),a.value instanceof Error?void 0!==t.fallback?t.fallback:a.expr.expression:void 0===a.value||null===a.value?"":a.value}return t.oldValue[n]}return s}),this.attribute||(s.presentational=this.value.map(function(t){return Array.isArray(t)?t.join(", "):"number"==typeof t?Mavo.Primitive.formatNumber(t):t}),s.presentational=1===s.presentational.length?s.presentational[0]:s.presentational.join("")),s.value=1===s.value.length?s.value[0]:s.value.join(""),this.primitive&&1===this.parsed.length&&("number"==typeof s.value?this.primitive.datatype="number":"boolean"==typeof s.value&&(this.primitive.datatype="boolean")),s.presentational===s.value&&(s=s.value),
this.primitive?this.primitive.value=s:Mavo.Primitive.setValue(this.node,s,{attribute:this.attribute}),Mavo.hooks.run("expressiontext-update-end",this)},"static":{elements:new WeakMap,search:function(t,i){var s=e.elements.get(t)||[];return arguments.length>1?s.length?s.filter(function(t){return t.attribute===i})[0]||null:null:s}}});Mavo.hooks.add("primitive-init-start",function(){this.expressionText=Mavo.ExpressionText.search(this.element,this.attribute),this.expressionText&&(this.expressionText.primitive=this,this.store=this.store||"none",this.modes="read")})}(Bliss);
"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t){var o=Mavo.Expressions=e.Class({constructor:function(e){var t=this;this.mavo=e,this.expressions=[];var n=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax["default"];this.traverse(this.mavo.element,void 0,n),this.scheduled=new Set,this.mavo.treeBuilt.then(function(){var e=!0,n=!1,i=void 0;try{for(var r,s=t.expressions[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value;a.item=Mavo.Node.get(a.element.closest(Mavo.selectors.multiple+", "+Mavo.selectors.group)),
a.item.expressions=a.item.expressions||[],a.item.expressions.push(a);var u=Mavo.Node.get(a.element,!0);u&&u instanceof Mavo.Primitive&&u.attribute==a.attribute&&(a.primitive=u,u.store=u.store||"none",u.modes="read")}}catch(l){n=!0,i=l}finally{try{!e&&s["return"]&&s["return"]()}finally{if(n)throw i}}t.mavo.element.addEventListener("mavo:datachange",function(e){"propertychange"==e.action&&e.node.closestCollection?t.scheduled.has(e.property)||(setTimeout(function(){t.scheduled["delete"](e.property),t.update(e)},o.PROPERTYCHANGE_THROTTLE),t.scheduled.add(e.property)):requestAnimationFrame(function(){return t.update(e)})}),t.update()})},update:function(t){var o,n,i=this;t instanceof Element&&(o=t.closest(Mavo.selectors.group),t=null),o=o||this.mavo.element,n=Mavo.Node.get(o);var r=n.getData({relative:!0,store:"*","null":!0,unhandled:this.mavo.unhandled});n.walk(function(o,n){if(o.expressions&&o.expressions.length&&!o.isDeleted()){var s={context:i,data:e.value.apply(e,[r].concat(_toConsumableArray(n)))
};Mavo.hooks.run("expressions-update-start",s);var a=!0,u=!1,l=void 0;try{for(var v,c=o.expressions[Symbol.iterator]();!(a=(v=c.next()).done);a=!0){var d=v.value;d.changedBy(t)&&d.update(s.data,t)}}catch(p){u=!0,l=p}finally{try{!a&&c["return"]&&c["return"]()}finally{if(u)throw l}}}})},extract:function(e,t,n,i){t&&"mv-expressions"==t.name||(t&&o.directives.indexOf(t.name)>-1||i.test(t?t.value:e.textContent))&&this.expressions.push(new Mavo.ExpressionText({node:e,syntax:i,path:n?n.slice(1).split("/").map(function(e){return+e}):[],attribute:t&&t.name,mavo:this.mavo}))},traverse:function(e){var o=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments[2];if(8!==e.nodeType)if(3===e.nodeType)this.extract(e,null,n,i);else{if(e.normalize(),i=Mavo.Expression.Syntax.create(e)||i,i===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("multiple",e)&&(n=""),t(e.attributes).forEach(function(t){return o.extract(e,t,n,i)}),t(e.childNodes).forEach(function(e,t){return o.traverse(e,n+"/"+t,i);
})}},"static":{directives:[],PROPERTYCHANGE_THROTTLE:50,directive:function(e,t){o.directives.push(e),Mavo.attributes.push(e),Mavo.plugin(t)}}});self.Proxy&&Mavo.hooks.add("node-getdata-end",function(e){var t=this;if(e.options.relative&&(e.data&&"object"===_typeof(e.data)||this.collection)){var o=e.data;if(this instanceof Mavo.Primitive){var n;e.data=(n={},_defineProperty(n,Symbol.toPrimitive,function(){return o}),_defineProperty(n,this.property,o),n)}e.data=new Proxy(e.data,{get:function(e,t,o){if(t in e||t in o&&t in e)return e[t]},has:function(o,n){if(n in o)return!0;if("$index"==n)return o[n]=(t.index||0)+1;if("$all"==n)return o[n]=t.closestCollection?t.closestCollection.getData(e.options):[e.data];if("$next"==n||"$previous"==n)return t.closestCollection?o[n]=t.closestCollection.getData(e.options)[t.index+("$next"==n?1:-1)]:o[n]=null;if(n==t.mavo.id)return o[n]=t.mavo.root.getData(e.options);if(t instanceof Mavo.Group&&n==t.property&&t.collection)return o[n]=e.data;var i=t.walkUp(function(e){
if(n in e.children)return e.children[n]});return void 0===i&&(i=t.find(n)),void 0!==i&&(Array.isArray(i)?i=i.map(function(t){return t.getData(e.options)}).filter(function(e){return null!==e}):i instanceof Mavo.Node&&(i=i.getData(e.options)),o[n]=i,!0)},set:function(e,t,o){throw Error("You can’t set data via expressions.")}})}}),Mavo.hooks.add("init-tree-before",function(){this.expressions=new Mavo.Expressions(this)}),Mavo.hooks.add("node-init-end",function(){var e=this,t=this.template;t&&t.expressions&&(this.expressions=t.expressions.map(function(t){return new Mavo.ExpressionText({template:t,item:e,mavo:e.mavo})}))}),Mavo.hooks.add("render-end",function(){this.expressions.update()}),Mavo.hooks.add("collection-add-end",function(e){this.mavo.expressions.update(e.item.element)})}(Bliss,Bliss.$),Mavo.Expressions.directive("mv-value",{hooks:{"expressiontext-init-start":function(){"mv-value"==this.attribute&&(this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{
attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end)}}});
"use strict";!function(e,t){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(e){this._hidden!==e&&(this._hidden=e,this.dataChanged())}}},ExpressionText:{lazy:{childProperties:function(){var e=this;if("mv-if"==this.attribute){var i=t(Mavo.selectors.property,this.element).filter(function(t){return t.closest("[mv-if]")==e.element}).map(function(e){return Mavo.Node.get(e)});return this.element.addEventListener("mavo:datachange",function(t){requestAnimationFrame(function(){e.element.parentNode||e.item.element.dispatchEvent(t)})}),i}}}}},hooks:{"expressiontext-init-start":function(){"mv-if"==this.attribute&&(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.ExpressionText.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)));
},"expressiontext-update-end":function(){var e=this;if("mv-if"==this.attribute){var t=this.value[0],i=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(e.parentIf){var n=e.parentIf.value[0];e.value[0]=t=t&&n}if(t!==i){if(n!==!1&&(t?e.comment&&e.comment.parentNode&&e.comment.parentNode.replaceChild(e.element,e.comment):e.element.parentNode&&(e.comment||(e.comment=document.createComment("mv-if")),e.element.parentNode.replaceChild(e.comment,e.element))),e.childProperties){var r=!0,s=!1,a=void 0;try{for(var o,h=e.childProperties[Symbol.iterator]();!(r=(o=h.next()).done);r=!0){var l=o.value;l.hidden=!t}}catch(d){s=!0,a=d}finally{try{!r&&h["return"]&&h["return"]()}finally{if(s)throw a}}}if(e.childIfs){var m=!0,f=!1,c=void 0;try{for(var v,u=e.childIfs[Symbol.iterator]();!(m=(v=u.next()).done);m=!0){var p=v.value;p.update()}}catch(d){f=!0,c=d}finally{try{!m&&u["return"]&&u["return"]()}finally{if(f)throw c}}}}})}},"unit-isdatanull":function(e){e.result=e.result||this.hidden&&"*"==e.options.store;
}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(r){if(Array.isArray(r)){for(var t=0,n=Array(r.length);t<r.length;t++)n[t]=r[t];return n}return Array.from(r)}var _slicedToArray=function(){function r(r,t){var n=[],a=!0,e=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(l){e=!0,i=l}finally{try{!a&&u["return"]&&u["return"]()}finally{if(e)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function r(r,t){return r=Array.isArray(r)?r:t?$$(t):[r],r.filter(function(r){return!isNaN(r)&&""!==r}).map(function(r){return+r})}var t=Mavo.Functions={operators:{"=":"eq"},get $now(){return new Date},urlOption:function(){for(var r=("searchParams"in URL.prototype?new URL(location).searchParams:null),t=null,n=arguments.length,a=Array(n),e=0;e<n;e++)a[e]=arguments[e];var i=!0,o=!1,u=void 0;try{
for(var l,c=a[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var s=l.value;if(r)t=r.get(s);else{var y=location.search.match(RegExp("[?&]"+s+"(?:=([^&]+))?(?=&|$)","i"));t=y&&(y[1]||"")}if(null!==t)return t}}catch(f){o=!0,u=f}finally{try{!i&&c["return"]&&c["return"]()}finally{if(o)throw u}}return null},get:function(r,t){return r&&void 0!==r[t]?r[t]:null},sum:function(t){return r(t,arguments).reduce(function(r,t){return+r+(+t||0)},0)},average:function(n){return n=r(n,arguments),n.length&&t.sum(n)/n.length},min:function(t){return Math.min.apply(Math,_toConsumableArray(r(t,arguments)))},max:function(t){return Math.max.apply(Math,_toConsumableArray(r(t,arguments)))},count:function(r){return Mavo.toArray(r).filter(function(r){return null!==r&&r!==!1&&""!==r}).length},round:function(r,t){return r&&t&&isFinite(r)?+r.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t}):Math.round(r)},iff:function(r,t){var n=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return Array.isArray(r)?r.map(function(r,a){
var e=r?t:n;return Array.isArray(e)?e[Math.min(a,e.length-1)]:e}):r?t:n},replace:function(r,n,a){var e=arguments.length<=3||void 0===arguments[3]?1:arguments[3];if(Array.isArray(r))return r.map(function(r){return t.replace(r,n,a)});for(var i,o=RegExp(Mavo.escapeRegExp(n),"g"),u=r,l=0;u!=i&&l++<e;)i=u,u=u.replace(o,a);return u},join:function(r){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return Mavo.toArray(r).join(t)},idify:function(r){return((r||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},uppercase:function(r){return(r+"").toUpperCase()},lowercase:function(r){return(r+"").toLowerCase()}};Mavo.Script={addUnaryOperator:function(r,t){return function(r){return Array.isArray(r)?r.map(t.scalar):t.scalar(r)}},addBinaryOperator:function(n,a){if(a.symbol){var e=!0,i=!1,o=void 0;try{for(var u,l=Mavo.toArray(a.symbol)[Symbol.iterator]();!(e=(u=l.next()).done);e=!0){var c=u.value;Mavo.Script.symbols[c]=n}}catch(s){i=!0,o=s}finally{try{!e&&l["return"]&&l["return"]();
}finally{if(i)throw o}}}return a.identity=void 0===a.identity?0:a.identity,t[n]=a.code||function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];1===n.length&&Array.isArray(n[0])&&(n=[].concat(_toConsumableArray(n[0])));for(var i,o=a.logical?a.identity:n[0],u=function(t){var e=a.logical?n[t-1]:o,u=n[t];Array.isArray(u)?("number"==typeof a.identity&&(u=r(u)),i=Array.isArray(e)?[].concat(_toConsumableArray(u.map(function(r,t){return a.scalar(void 0===e[t]?a.identity:e[t],r)})),_toConsumableArray(e.slice(u.length))):u.map(function(r){return a.scalar(e,r)})):("number"==typeof a.identity&&(u=+u),i=Array.isArray(e)?e.map(function(r){return a.scalar(r,u)}):a.scalar(e,u)),o=a.reduce?a.reduce(o,i,e,u):a.logical?o&&i:i},l=1;l<n.length;l++)u(l);return o}},symbols:{},getOperatorName:function(r){return Mavo.Script.symbols[r]||r},operators:{not:{scalar:function(r){return function(r){return!r}}},multiply:{scalar:function(r,t){return r*t},identity:1,symbol:"*"},divide:{scalar:function(r,t){
return r/t},identity:1,symbol:"/"},add:{scalar:function(r,t){return+r+ +t},symbol:"+"},subtract:{scalar:function(r,t){return r-t},symbol:"-"},mod:{scalar:function(r,t){return r%t}},lte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<=t},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<t},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r>=t},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r>t},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(r,t){return r==t},symbol:["=","=="],identity:!0},neq:{logical:!0,scalar:function(r,t){return r!=t},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(r,t){return!!r&&!!t;
},identity:!0,symbol:"&&"},or:{logical:!0,scalar:function(r,t){return!!r||!!t},reduce:function(r,t){return r||t},identity:!1,symbol:"||"},concatenate:{symbol:"&",identity:"",scalar:function(r,t){return""+r+t}},filter:{scalar:function(r,t){return t?r:null}}},getNumericalOperands:function(r,t){if(isNaN(r)||isNaN(t)){var n=new Date(r),a=new Date(t);if(!isNaN(n)&&!isNaN(a))return[n,a]}return[r,t]}};for(var n in Mavo.Script.operators){var a=Mavo.Script.operators[n];a.scalar.length<2?Mavo.Script.addUnaryOperator(n,a):Mavo.Script.addBinaryOperator(n,a)}var e={average:"avg",iff:"iff IF",subtract:"minus",multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"},i=function(r){e[r].split(/\s+/g).forEach(function(n){return t[n]=t[r]})};for(var o in e)i(o);Mavo.Functions._Trap=self.Proxy?new Proxy(t,{get:function(r,t){if(t in r)return r[t];var n=t.toLowerCase&&t.toLowerCase();return n&&r.hasOwnProperty(n)?r[n]:t in Math||n in Math?Math[t]||Math[n]:t in self?self[t]:t;
},has:function(r,t){return"data"!=t}}):Mavo.Functions}();
"use strict";var prettyPrint=function(){var e={txt:function(e){return e+="",document.createTextNode(e)},row:function(t,n,r){r=r||"td";var i,o=e.count(t,null)+1,a=$.create("tr"),d={colSpan:o};return $$(t).forEach(function(t){null!==t&&(i=$.create(r,d),t.nodeType?i.appendChild(t):i.innerHTML=e.shorten(t.toString()),a.appendChild(i))}),a},hRow:function(t,n){return e.row(t,n,"th")},table:function(t,n){t=t||[];var r=$.create("table"),i=$.create("thead"),o=$.create("tbody");return r.classList.add(n),t.length&&(r.appendChild(i),i.appendChild(e.hRow(t,n))),r.appendChild(o),{node:r,tbody:o,thead:i,appendChild:function(e){this.tbody.appendChild(e)},addRow:function(t,r,i){return this.appendChild(e.row(t,r||n,i)),this}}},shorten:function(e){var t=40;return e=e.replace(/^\s\s*|\s\s*$|\n/g,""),e.length>t?e.substring(0,t-1)+"...":e},htmlentities:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},count:function n(e,t){for(var n=0,r=0,i=e.length;r<i;r++)e[r]===t&&n++;return n;
},thead:function(e){return e.getElementsByTagName("thead")[0]},within:function(e){return{is:function(t){for(var n in e)if(e[n]===t)return n;return""}}},common:{circRef:function(n,r,i){return e.expander("[POINTS BACK TO <strong>"+r+"</strong>]","Click to show this item anyway",function(){this.parentNode.appendChild(t(n,{maxDepth:1}))})},depthReached:function(n,r){return e.expander("[DEPTH REACHED]","Click to show this item anyway",function(){try{this.parentNode.appendChild(t(n,{maxDepth:1}))}catch(r){this.parentNode.appendChild(e.table(["ERROR OCCURED DURING OBJECT RETRIEVAL"],"error").addRow([r.message]).node)}})}},expander:function(t,n,r){return $.create("a",{innerHTML:e.shorten(t)+' <b style="visibility:hidden;">[+]</b>',title:n,onmouseover:function(){this.getElementsByTagName("b")[0].style.visibility="visible"},onmouseout:function(){this.getElementsByTagName("b")[0].style.visibility="hidden"},onclick:function(){return this.style.display="none",r.call(this),!1},style:{cursor:"pointer"
}})}},t=function r(t,n){n=n||{};var i=$.extend({},r.config,n),o=$.create("div"),a=(r.config,0),d={},c=!1;r.settings=i;var l={string:function(t){return e.txt('"'+e.shorten(t.replace(/"/g,'\\"'))+'"')},object:function(t,n,r){var o=e.within(d).is(t);if(o)return e.common.circRef(t,o,i);if(d[r||"TOP"]=t,n===i.maxDepth)return e.common.depthReached(t,i);var a=e.table(["Group",null],"object"),u=!0;for(var s in t)if(!t.hasOwnProperty||t.hasOwnProperty(s)){var h=t[s],p=$.type(h);u=!1;try{a.addRow([s,l[p](h,n+1,s)],p)}catch(f){window.console&&window.console.log&&console.log(f.message)}}var m=i.expanded||c?a.node:e.expander(JSON.stringify(t),"Click to show more",function(){this.parentNode.appendChild(a.node)});return c=!0,m},array:function(t,n,r,o){var a=e.within(d).is(t);if(a)return e.common.circRef(t,a);if(d[r||"TOP"]=t,n===i.maxDepth)return e.common.depthReached(t);var c=e.table(["List ("+t.length+" items)",null],"list"),u=!0,s=0;return $$(t).forEach(function(e,r){return i.maxArray>=0&&++s>i.maxArray?(c.addRow([r+".."+(t.length-1),l[$.type(e)]("...",n+1,r)]),
!1):(u=!1,void c.addRow([r,l[$.type(e)](e,n+1,r)]))}),i.expanded?c.node:e.expander(JSON.stringify(t),"Click to show more",function(){this.parentNode.appendChild(c.node)})},date:function(t){var n=e.table(["Date",null],"date"),r=t.toString().split(/\s/);return n.addRow(["Time",r[4]]).addRow(["Date",r.slice(0,4).join("-")]),i.expanded?n.node:e.expander("Date (timestamp): "+ +t,"Click to see a little more info about this date",function(){this.parentNode.appendChild(n.node)})}};return l.number=l["boolean"]=l.undefined=l["null"]=l["default"]=function(t){return e.txt(t)},o.appendChild(l[$.type(t)](t,a)),o};return t.config={expanded:!0,maxDepth:10,maxArray:-1},t}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function($,$$){var _=Mavo.Debug={friendlyError:function(e,t){var n=e.constructor.name.replace(/Error$/,"").toLowerCase(),o=e.message;return o=o.replace(/\s+token\s+/g," "),"Unexpected }"!=o||/[{}]/.test(t)?"Unexpected )"===o?o="Missing a (":"Invalid left-hand side in assignment"===o?o="Invalid assignment. Maybe you typed = instead of == ?":"Unexpected ILLEGAL"==o&&(o="There is an invalid character somewhere."):o="Missing a )",'<span class="type">Oh noes, a '+n+" error!</span> "+o},elementLabel:function(e,t){var n=e.nodeName.toLowerCase();return e.hasAttribute("property")?n+="[property="+e.getAttribute("property")+"]":e.id?n+="#"+e.id:e.classList.length&&(n+=$$(e.classList).map(function(e){return"."+e}).join("")),t&&(n+="@"+t),n},printValue:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))||null===e?"string"==typeof e?'"'+e+'"':e+"":Array.isArray(e)?e.length>0?"object"===_typeof(e[0])?"List: "+e.length+" group(s)":"List: "+e.map(_.printValue).join(", "):"List: (Empty)":e.constructor===Object?"Group with "+Object.keys(e).length+" properties":e instanceof Mavo.Primitive?_.printValue(e.value):e instanceof Mavo.Collection?e.children.length>0?e.children[0]instanceof Mavo.Group?"List: "+e.children.length+" group(s)":"List: "+e.children.map(_.printValue).join(", "):_.printValue([]):e instanceof Mavo.Group?"Group with "+Object.keys(e).length+" properties":void 0;
},timed:function(e,t){return function(){console.time(e),t.apply(this,arguments),console.timeEnd(e)}},time:function callee(objName,name){var obj=eval(objName);console.log("Benchmarking "+objName+"."+name+"(). Run console.log("+objName+"."+name+".timeTaken, "+objName+"."+name+".calls) at any time to see stats.");var callback=obj[name];return obj[name]=function e(){var t=performance.now(),n=callback.apply(this,arguments);return e.timeTaken+=performance.now()-t,obj[name].calls++,n},obj[name].timeTaken=obj[name].calls=0,callee.all=callee.all||[],callee.all.push({obj:obj,objName:objName,name:name}),obj[name]},times:function(){_.time.all&&console.table(_.time.all.map(function(e){return{Function:e.objName+"."+e.name,"Time (ms)":e.obj[e.name].timeTaken,Calls:e.obj[e.name].calls}}))},reservedWords:"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield".split("|")
};Mavo.prototype.render=_.timed("render",Mavo.prototype.render),Mavo.selectors.debug=".mv-debug";var selector=", .mv-debuginfo";Stretchy.selectors.filter+=selector,Mavo.hooks.add("init-tree-after",function(){if(this.root.debug&&this.element.classList.add("mv-debug-saving"),this.store&&this.element.classList.contains("mv-debug-saving")){var e;$.create("details",{className:"mv-debug-storage",contents:[{tag:"Summary",textContent:"Saved data"},e=$.create("pre",{id:this.id+"-debug-storage"})],after:this.element});this.element.addEventListener("mavo:save",function(t){e.innerHTML="",e.appendChild(prettyPrint(t.data))})}}),Mavo.hooks.add("render-start",function(e){var t=e.data;if(this.backend&&this.element.classList.contains("mv-debug-saving")){var n=$("#"+this.id+"-debug-storage");n&&(n.innerHTML="",t&&n.appendChild(prettyPrint(t)))}}),Mavo.hooks.add("group-init-start",function(){this.debug=this.debug||this.walkUp(function(e){if(e.debug)return!0})||null!==Mavo.Functions.urlOption("debug"),!this.debug&&this.element.closest(Mavo.selectors.debug)&&(this.debug=!0),
this.debug&&(this.debug=$.create("tbody",{inside:$.create("table",{innerHTML:"<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>",style:{display:"none"},inside:$.create("details",{className:"mv-ui mv-debuginfo",inside:this.element,contents:$.create("summary",{textContent:"Debug"}),"mv-expressions":"none"})})}))},!0),Mavo.hooks.add("node-init-end",function(){this.collection&&(this.debug=this.collection.debug)}),Mavo.hooks.add("expression-eval-beforeeval",function(){this.debug&&this.debug.classList.remove("mv-error")}),Mavo.hooks.add("expression-eval-error",function(e){this.debug&&(this.debug.innerHTML=_.friendlyError(e.exception,e.expression),this.debug.classList.add("mv-error"))}),Mavo.Group.prototype.debugRow=function(e){var t=e.element,n=e.attribute,o=void 0===n?null:n,a=e.tds,r=void 0===a?[]:a;if(this.debug){this.debug.parentNode.style.display="";var i=r[0];if(r[0]=$.create("td",{title:i}),!r[3]){
var s=_.elementLabel(t,o);r[3]=$.create("td",{textContent:s,title:s,events:{"mouseenter mouseleave":function(e){t.classList.toggle("mv-highlight","mouseenter"===e.type)},click:function(e){t.scrollIntoView({behavior:"smooth"})}}})}r=r.map(function(e){return e instanceof Node?e:$.create("td","object"==("undefined"==typeof e?"undefined":_typeof(e))?e:{textContent:e})}),"Warning"==i&&r[1].setAttribute("colspan",2);$.create("tr",{className:"mv-debug-"+i.toLowerCase(),contents:r,inside:this.debug})}},Mavo.hooks.add("expressiontext-init-end",function(){var e=this;this.mavo.debug&&(this.debug={},this.parsed.forEach(function(t){t instanceof Mavo.Expression&&!e.element.matches(".mv-debuginfo *")&&e.group.debugRow({element:e.element,attribute:e.attribute,tds:["Expression",{tag:"td",contents:{tag:"textarea",value:t.expression,events:{input:function(n){t.expression=n.target.value,t.debug=n.target.parentNode.nextElementSibling,e.update(e.data)}},once:{focus:function(e){return Stretchy.resize(e.target);
}}}},t.debug=$.create("td")]})}))}),Mavo.hooks.add("group-init-end",function(){var e=this;if(this.debug instanceof Node){var t=Mavo.selectors.andNot(Mavo.selectors.multiple,Mavo.selectors.property);$$(t,this.element).forEach(function(t){e.debugRow({element:t,tds:["Warning","mv-multiple without a property attribute"]})}),this.propagate(function(t){_.printValue(t);e.debugRow({element:t.element,tds:["Property",t.property,t.value]}),_.reservedWords.indexOf(t.property)>-1?e.debugRow({element:t.element,tds:["Warning",'You can’t use "'+t.property+'" as a property name, it’s a reserved word.']}):/^\d|[\W$]/.test(t.property)&&e.debugRow({element:t.element,tds:["Warning",{textContent:'You can’t use "'+t.property+'" as a property name.',title:"Property names can only contain letters, numbers and underscores and cannot start with a number."}]})}),this.group.element.addEventListener("mavo:datachange",function(t){$$("tr.debug-property",e.debug).forEach(function(t){var n=t.cells[1].textContent,o=_.printValue(e.children[n]);
if(t.cells[2]){var a=t.cells[2];a.textContent=a.title=o}})})}}),Mavo.hooks.add("expressiontext-update-beforeeval",function(e){this.debug&&(e.td=e.expr.debug,e.td&&e.td.classList.remove("mv-error"))}),Mavo.hooks.add("expressiontext-update-aftereval",function(e){if(e.td&&!e.td.classList.contains("mv-error")){var t=_.printValue(e.value);e.td.textContent=e.td.title=t}})}(Bliss,Bliss.$);
"use strict";!function(e){if(self.Mavo){var t="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Mavo.Backend.register(e.Class({"extends":Mavo.Backend,id:"Dropbox",constructor:function(){var o=this;this.url=new URL(this.url,location),"dropbox:"!=this.url.protocol&&(this.url.hostname="dl.dropboxusercontent.com",this.url.search=this.url.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.on("read")),this.permissions.on("login"),this.ready=e.include(self.Dropbox,t).then(function(){var t=new URL(document.referrer,location);return"www.dropbox.com"===t.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),e.fire(window,"load"),void close()):(o.path=(o.mavo.element.getAttribute("mv-dropbox-path")||"")+new URL(o.url).pathname.match(/[^\/]*$/)[0],o.key=o.mavo.element.getAttribute("mv-dropbox-key")||"fle6gsc61w5v79j",void(o.client=new Dropbox.Client({key:o.key})))}).then(function(){o.login(!0)})},put:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];
return new Promise(function(o,n){e.client.writeFile(t.name,t.dataString,function(e,i){return e?n(Error(e)):(console.log("File saved as revision "+i.versionTag),void o(t))})})},login:function(t){var o=this;return this.ready.then(function(){return o.client.isAuthenticated()?Promise.resolve():new Promise(function(e,n){o.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),o.client.authenticate({interactive:!t},function(t,i){t&&n(Error(t)),o.client.isAuthenticated()?(o.permissions.on(["logout","edit"]),e()):(o.permissions.off(["logout","edit","add","delete"]),n())})})}).then(function(){o.client.getAccountInfo(function(t,n){t||e.fire(o.mavo.element,"mavo:login",e.extend({backend:o},n))})})["catch"](function(){})},logout:function(){var e=this;return this.client.isAuthenticated()?new Promise(function(t,o){e.client.signOut(null,function(){e.permissions.off(["edit","add","delete"]).on("login"),e.mavo.element._.fire("mavo:logout",{backend:e}),t()})}):Promise.resolve();
},"static":{test:function(e){return e=new URL(e,location),/dropbox.com/.test(e.host)||"dropbox:"===e.protocol}}}))}}(Bliss);
"use strict";!function(t){if(self.Mavo)var e=Mavo.Backend.register(t.Class({"extends":Mavo.Backend,id:"Github",constructor:function(){this.permissions.on("login"),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e",this.url=new URL(this.url,location),t.extend(this,e.parseURL(this.url)),this.repo=this.repo||"mv-data",this.branch=this.branch||"master",this.path=this.path||this.mavo.id+".json",this.permissions.on("read"),this.login(!0)},get authenticated(){return!!this.accessToken},req:function(e,n){var o=this,r=arguments.length<=2||void 0===arguments[2]?"GET":arguments[2],i=arguments.length<=3||void 0===arguments[3]?{method:r}:arguments[3];n&&(i.data=JSON.stringify(n));var s=t.extend(i,{responseType:"json"});return this.authenticated&&(s.headers={Authorization:"token "+this.accessToken}),t.fetch("https://api.github.com/"+e,s)["catch"](function(t){return t&&t.xhr?Promise.reject(t.xhr):void o.mavo.error("Something went wrong while connecting to Github",t)}).then(function(t){
return Promise.resolve(t.response)})},get:function(){return this.req("repos/"+this.username+"/"+this.repo+"/contents/"+this.path).then(function(t){return Promise.resolve(e.atob(t.content))})},put:function(){var t=this,n=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0],o="repos/"+this.username+"/"+this.repo+"/contents/"+n.path;return Promise.resolve(this.repoInfo||this.req("user/repos",{name:this.repo},"POST")).then(function(e){return t.repoInfo=e,t.req(o,{ref:t.branch})}).then(function(r){return t.req(o,{message:"Updated "+(n.name||"file"),content:e.btoa(n.dataString),branch:t.branch,sha:r.sha},"PUT").then(function(t){return n})},function(r){return 404==r.status?t.req(o,{message:"Created file",content:e.btoa(n.dataString),branch:t.branch},"PUT"):(t.mavo.error(r.status?"HTTP error "+r.status:"Can’t connect to the Internet",r),null)})},login:function(t){var e=this;return this.ready.then(function(){return e.authenticated?Promise.resolve():new Promise(function(n,o){if(t)e.accessToken=localStorage["mavo:githubtoken"],
e.accessToken&&n(e.accessToken);else{var r={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};r.top=(innerHeight-r.height)/2+(screen.top||screenTop),r.left=(innerWidth-r.width)/2+(screen.left||screenLeft),e.authPopup=open("https://github.com/login/oauth/authorize?client_id="+e.key+"&scope=repo,gist&state="+location.href,"popup","width="+r.width+",height="+r.height+",left="+r.left+",top="+r.top),addEventListener("message",function(t){t.source===e.authPopup&&(e.accessToken=localStorage["mavo:githubtoken"]=t.data,e.accessToken||o(Error("Authentication error")),n(e.accessToken))})}}).then(function(){return e.getUser()})["catch"](function(t){401==t.status&&e.logout()}).then(function(t){if(e.user)return e.permissions.on("logout"),e.req("repos/"+e.username+"/"+e.repo).then(function(t){e.repoInfo=t,t.permissions.push&&e.permissions.on(["edit","save"])})["catch"](function(t){404==t.status&&e.user.login.toLowerCase()==e.username.toLowerCase()&&e.permissions.on(["edit","save"]);
})})})},logout:function(){return this.authenticated&&(localStorage.removeItem("mavo:githubtoken"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this})),Promise.resolve()},getUser:function(){var e=this;return this.req("user").then(function(n){e.user=n;var o=n.name||n.login;t.fire(e.mavo.element,"mavo:login",{backend:e,name:'<a href="https://github.com/'+n.login+'" target="_blank">\n\t\t\t\t\t\t\t<img class="mv-avatar" src="'+n.avatar_url+'" /> '+o+"\n\t\t\t\t\t\t</a>"})})},"static":{test:function(t){return t=new URL(t,location),/\bgithub.(com|io)|raw.githubusercontent.com/.test(t.host)},parseURL:function(t){var e={};t=new URL(t,location);var n=t.pathname.slice(1).split("/");if(/github.io$/.test(t.host)){if(e.username=t.host.match(/([\w-]+)\.github\.io$/)[1],1==n.length)return e.repo=t.host,e.path=n[0],e.branch="master",e;e.branch="gh-pages"}else e.username=n.shift();return e.repo=n.shift(),/raw.githubusercontent.com$/.test(t.host)?e.branch=n.shift():/github.com$/.test(t.host)&&"blob"==n[0]&&(n.shift(),
e.branch=n.shift()),e.path=n.join("/"),e},btoa:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return btoa(unescape(encodeURIComponent(t)))}),atob:function(t){return decodeURIComponent(escape(window.atob(t)))}}}))}(Bliss);
//# sourceMappingURL=maps/mavo.min.js.map
